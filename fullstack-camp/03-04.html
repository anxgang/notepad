<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4-手動實作討論群的“新增”“修改”“刪除”功能 | notepad</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/notepad/favicon.ico">
    <meta name="description" content="一個小小筆記本">
    <link rel="preload" href="/notepad/assets/css/0.styles.e4f7a2f2.css" as="style"><link rel="preload" href="/notepad/assets/js/app.abc900cd.js" as="script"><link rel="preload" href="/notepad/assets/js/2.de767da7.js" as="script"><link rel="preload" href="/notepad/assets/js/4.f36ccaf5.js" as="script"><link rel="prefetch" href="/notepad/assets/js/10.b2c06949.js"><link rel="prefetch" href="/notepad/assets/js/11.c9e2691f.js"><link rel="prefetch" href="/notepad/assets/js/12.63f79b42.js"><link rel="prefetch" href="/notepad/assets/js/13.f7af4e8d.js"><link rel="prefetch" href="/notepad/assets/js/14.31b24aa9.js"><link rel="prefetch" href="/notepad/assets/js/15.ee275869.js"><link rel="prefetch" href="/notepad/assets/js/16.baece4fe.js"><link rel="prefetch" href="/notepad/assets/js/17.40bc1197.js"><link rel="prefetch" href="/notepad/assets/js/18.1c6f3d85.js"><link rel="prefetch" href="/notepad/assets/js/19.ffd304a8.js"><link rel="prefetch" href="/notepad/assets/js/20.d16e10f7.js"><link rel="prefetch" href="/notepad/assets/js/21.9bf663a6.js"><link rel="prefetch" href="/notepad/assets/js/22.a96f91d1.js"><link rel="prefetch" href="/notepad/assets/js/23.d82ddc41.js"><link rel="prefetch" href="/notepad/assets/js/24.cbdef2f9.js"><link rel="prefetch" href="/notepad/assets/js/25.236bf007.js"><link rel="prefetch" href="/notepad/assets/js/26.42754cbe.js"><link rel="prefetch" href="/notepad/assets/js/27.69e3f6e3.js"><link rel="prefetch" href="/notepad/assets/js/28.917a0ffd.js"><link rel="prefetch" href="/notepad/assets/js/29.a5dfebe9.js"><link rel="prefetch" href="/notepad/assets/js/3.b28a5640.js"><link rel="prefetch" href="/notepad/assets/js/30.f3254c32.js"><link rel="prefetch" href="/notepad/assets/js/31.3671faaa.js"><link rel="prefetch" href="/notepad/assets/js/32.156d06d3.js"><link rel="prefetch" href="/notepad/assets/js/33.82cadb70.js"><link rel="prefetch" href="/notepad/assets/js/34.c1b3533d.js"><link rel="prefetch" href="/notepad/assets/js/35.14bbedca.js"><link rel="prefetch" href="/notepad/assets/js/36.1d786d21.js"><link rel="prefetch" href="/notepad/assets/js/37.ae49daca.js"><link rel="prefetch" href="/notepad/assets/js/38.14c91a38.js"><link rel="prefetch" href="/notepad/assets/js/39.949464aa.js"><link rel="prefetch" href="/notepad/assets/js/40.ac472316.js"><link rel="prefetch" href="/notepad/assets/js/41.2aa5b49e.js"><link rel="prefetch" href="/notepad/assets/js/42.082133ed.js"><link rel="prefetch" href="/notepad/assets/js/43.2c454234.js"><link rel="prefetch" href="/notepad/assets/js/44.3e01dbc8.js"><link rel="prefetch" href="/notepad/assets/js/45.c1b3a767.js"><link rel="prefetch" href="/notepad/assets/js/46.1b528671.js"><link rel="prefetch" href="/notepad/assets/js/47.fa275e25.js"><link rel="prefetch" href="/notepad/assets/js/48.82431801.js"><link rel="prefetch" href="/notepad/assets/js/49.26b95970.js"><link rel="prefetch" href="/notepad/assets/js/5.d8810cd1.js"><link rel="prefetch" href="/notepad/assets/js/50.080a8b89.js"><link rel="prefetch" href="/notepad/assets/js/51.eb4ba65f.js"><link rel="prefetch" href="/notepad/assets/js/52.9b2ec4b6.js"><link rel="prefetch" href="/notepad/assets/js/53.b9291662.js"><link rel="prefetch" href="/notepad/assets/js/54.adf368fd.js"><link rel="prefetch" href="/notepad/assets/js/55.7b43fc99.js"><link rel="prefetch" href="/notepad/assets/js/56.40f4e551.js"><link rel="prefetch" href="/notepad/assets/js/57.283e1e67.js"><link rel="prefetch" href="/notepad/assets/js/58.60dd1afe.js"><link rel="prefetch" href="/notepad/assets/js/59.f1434f61.js"><link rel="prefetch" href="/notepad/assets/js/6.466d8455.js"><link rel="prefetch" href="/notepad/assets/js/7.f05a3669.js"><link rel="prefetch" href="/notepad/assets/js/8.5d885b12.js"><link rel="prefetch" href="/notepad/assets/js/9.5e35ba9f.js">
    <link rel="stylesheet" href="/notepad/assets/css/0.styles.e4f7a2f2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notepad/" class="home-link router-link-active"><!----> <span class="site-name">notepad</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notepad/git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/notepad/ruby/" class="nav-link">
  Ruby
</a></div><div class="nav-item"><a href="/notepad/rails/" class="nav-link">
  Rails
</a></div><div class="nav-item"><a href="/notepad/javascript/" class="nav-link">
  Javascript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="More" class="dropdown-title"><span class="title">More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notepad/roadmap/" class="nav-link">
  開發者路線指引
</a></li><li class="dropdown-item"><!----> <a href="/notepad/basic-for-web-developers/" class="nav-link">
  網頁基礎(HTML&amp;CSS)
</a></li><li class="dropdown-item"><!----> <a href="/notepad/fullstack-camp/" class="nav-link router-link-active">
  全棧營(Rails101)
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notepad/git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/notepad/ruby/" class="nav-link">
  Ruby
</a></div><div class="nav-item"><a href="/notepad/rails/" class="nav-link">
  Rails
</a></div><div class="nav-item"><a href="/notepad/javascript/" class="nav-link">
  Javascript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="More" class="dropdown-title"><span class="title">More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notepad/roadmap/" class="nav-link">
  開發者路線指引
</a></li><li class="dropdown-item"><!----> <a href="/notepad/basic-for-web-developers/" class="nav-link">
  網頁基礎(HTML&amp;CSS)
</a></li><li class="dropdown-item"><!----> <a href="/notepad/fullstack-camp/" class="nav-link router-link-active">
  全棧營(Rails101)
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第零課、入學手冊</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第一課、環境建置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第二課、初級練習</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>第三課、Rails101</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notepad/fullstack-camp/03-01.html" class="sidebar-link">1-教材介紹</a></li><li><a href="/notepad/fullstack-camp/03-02.html" class="sidebar-link">2-開始吧!</a></li><li><a href="/notepad/fullstack-camp/03-03.html" class="sidebar-link">3-建立一個討論群組</a></li><li><a href="/notepad/fullstack-camp/03-04.html" aria-current="page" class="active sidebar-link">4-手動實作討論群的“新增”“修改”“刪除”功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/03-04.html#_4-1-本章目標" class="sidebar-link">4-1 本章目標</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/03-04.html#_4-2-實作討論群-新增-功能" class="sidebar-link">4-2 實作討論群“新增”功能</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/03-04.html#_4-3-實作討論群-瀏覽-功能" class="sidebar-link">4-3 實作討論群“瀏覽”功能</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/03-04.html#_4-4-實作討論群-編輯-功能" class="sidebar-link">4-4 實作討論群“編輯”功能</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/03-04.html#_4-5-實作討論群-刪除-功能" class="sidebar-link">4-5 實作討論群“刪除”功能</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/03-04.html#_4-6-限制-標題為空-的group，不能被新增" class="sidebar-link">4-6 限制“標題為空”的Group，不能被新增</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/03-04.html#_4-7-共用-表單" class="sidebar-link">4-7 共用“表單”</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/03-04.html#_4-8-使用-simpleform-簡化表單" class="sidebar-link">4-8 使用 SimpleForm 簡化表單</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/03-04.html#_4-9（解說）rails-的-crud-與-restful" class="sidebar-link">4-9（解說）Rails 的 CRUD 與 RESTful</a></li></ul></li><li><a href="/notepad/fullstack-camp/03-05.html" class="sidebar-link">5-加入使用者功能</a></li><li><a href="/notepad/fullstack-camp/03-06.html" class="sidebar-link">6-在討論群裡面“發表文章”</a></li><li><a href="/notepad/fullstack-camp/03-07.html" class="sidebar-link">7-使用者應該要“加入社團”才能發表文章</a></li><li><a href="/notepad/fullstack-camp/03-08.html" class="sidebar-link">8-使用者可以在“自己的後台”看過曾經發表的文章、以及創立的社團</a></li><li><a href="/notepad/fullstack-camp/03-09.html" class="sidebar-link">9-修飾細節，使用 Helper 與 Partial</a></li><li><a href="/notepad/fullstack-camp/03-10.html" class="sidebar-link">10-上傳到 github 與 heroku</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_4-手動實作討論群的-新增-修改-刪除-功能"><a href="#_4-手動實作討論群的-新增-修改-刪除-功能" class="header-anchor">#</a> 4-手動實作討論群的“新增”“修改”“刪除”功能</h1> <blockquote><p>預計學習時間: 1小時以內</p></blockquote> <h2 id="_4-1-本章目標"><a href="#_4-1-本章目標" class="header-anchor">#</a> 4-1 本章目標</h2> <h3 id="目標"><a href="#目標" class="header-anchor">#</a> 目標</h3> <ul><li>實作看板的“新增” new / create</li> <li>實作看板的“編輯” edit / update</li> <li>實作看板的“刪除” destroy</li></ul> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-11-10.c4276cb7.jpg" alt=""></p> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-30-26.e51bfe6b.jpg" alt=""></p> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-42-08.8a3b179a.jpg" alt=""></p> <p><strong>額外會談到的主題是：</strong></p> <ul><li>使用 gem &quot;simple_form&quot; 產生表單</li> <li>限制看板標題“不得為空”</li></ul> <h2 id="_4-2-實作討論群-新增-功能"><a href="#_4-2-實作討論群-新增-功能" class="header-anchor">#</a> 4-2 實作討論群“新增”功能</h2> <h3 id="目標-2"><a href="#目標-2" class="header-anchor">#</a> 目標</h3> <ul><li>這一章我們要實作 討論群 的新增功能</li></ul> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-11-10.c4276cb7.jpg" alt=""></p> <h3 id="步驟"><a href="#步驟" class="header-anchor">#</a> 步驟</h3> <h4 id="step-0-git-checkout-b-ch03"><a href="#step-0-git-checkout-b-ch03" class="header-anchor">#</a> Step 0. git checkout -b ch03</h4> <p>因為我們現在要實作第三章的內容，新增一個 branch 把實作內容集中在 ch03 是比較合理的。將來回顧就可以比較清楚 在 ch03 我們做了哪一些練習。</p> <p><code>git checkout -b ch03</code></p> <h4 id="step-1-建立-new-action"><a href="#step-1-建立-new-action" class="header-anchor">#</a> Step 1. 建立 new action</h4> <p>修改 app/controllers/groups_controller.rb 加入 new action</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/controllers/groups_controller.rb</span>
<span class="token keyword">class</span> <span class="token class-name">GroupsController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">index</span></span>
    <span class="token variable">@groups</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span>all
  <span class="token keyword">end</span>

<span class="token operator">+</span> <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">new</span></span>
<span class="token operator">+</span>   <span class="token variable">@group</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span><span class="token keyword">new</span>
<span class="token operator">+</span> <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><h4 id="step-2-建立-new-action-的表單"><a href="#step-2-建立-new-action-的表單" class="header-anchor">#</a> Step 2. 建立 new action 的表單</h4> <p><code>touch app/views/groups/new.html.erb</code></p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token comment">&lt;!-- app/views/groups/new.html.erb --&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>row justify-content-center mt-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>col-5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>新增討論版<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>

    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> form_for <span class="token variable">@group</span> <span class="token keyword">do</span> <span class="token operator">|</span>f<span class="token operator">|</span> <span class="token delimiter punctuation">%&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>form-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>group_title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>標題<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> f<span class="token punctuation">.</span>text_field <span class="token symbol">:title</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'form-control'</span> <span class="token delimiter punctuation">%&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>form-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>group_description<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>敘述<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> f<span class="token punctuation">.</span>text_area <span class="token symbol">:description</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'form-control'</span> <span class="token delimiter punctuation">%&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>form-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> f<span class="token punctuation">.</span>submit <span class="token string">&quot;Submit&quot;</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'btn btn-primary'</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span>disable_with<span class="token punctuation">:</span> <span class="token string">'Submitting...'</span><span class="token punctuation">}</span> <span class="token delimiter punctuation">%&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">end</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然後打開 http://localhost:3000/groups/new，可以見到成果</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-11-10.c4276cb7.jpg" alt=""></p> <h4 id="step-3-git-存檔"><a href="#step-3-git-存檔" class="header-anchor">#</a> Step 3. git 存檔</h4> <p><code>git add .</code><br> <code>git commit -m &quot;implement groups#new&quot;</code></p> <h4 id="step-4-建立-create-action，接收數據並儲存"><a href="#step-4-建立-create-action，接收數據並儲存" class="header-anchor">#</a> Step 4. 建立 create action，接收數據並儲存</h4> <p>目前還只是個表單畫面，無法將數據送出後成功建立出一筆討論版的數據，缺了 action create。如果此時你按下 Submit，會看到這樣的畫面：</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-16-35.fad24c35.jpg" alt=""></p> <p>所以這時候，我們要實作 create action，接收 new 裡的表單送出的訊息，變成一筆存在數據庫裡的數據。</p> <p>修改 app/controllers/groups_controller.rb</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/controllers/groups_controller.rb</span>
<span class="token keyword">class</span> <span class="token class-name">GroupsController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">index</span></span>
    <span class="token variable">@groups</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span>all
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">new</span></span>
    <span class="token variable">@group</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span><span class="token keyword">new</span>
  <span class="token keyword">end</span>

<span class="token operator">+</span> <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">create</span></span>
<span class="token operator">+</span>   <span class="token variable">@group</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>group_params<span class="token punctuation">)</span>
<span class="token operator">+</span>   <span class="token variable">@group</span><span class="token punctuation">.</span>save
<span class="token operator">+</span>
<span class="token operator">+</span>     redirect_to groups_path
<span class="token operator">+</span> <span class="token keyword">end</span>
<span class="token operator">+</span>
<span class="token operator">+</span> <span class="token keyword">private</span>
<span class="token operator">+</span>
<span class="token operator">+</span> <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">group_params</span></span>
<span class="token operator">+</span>   params<span class="token punctuation">.</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token symbol">:group</span><span class="token punctuation">)</span><span class="token punctuation">.</span>permit<span class="token punctuation">(</span><span class="token symbol">:title</span><span class="token punctuation">,</span> <span class="token symbol">:description</span><span class="token punctuation">)</span>
<span class="token operator">+</span> <span class="token keyword">end</span>  
<span class="token keyword">end</span>
</code></pre></div><p>完成後再送一次即可成功建立數據，可以多建幾筆數據測試功能。</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-14-12.dc433e86.jpg" alt=""></p> <h3 id="step-5-git-存檔"><a href="#step-5-git-存檔" class="header-anchor">#</a> Step 5. git 存檔</h3> <p><code>git add .</code><br> <code>git commit -m &quot;implement groups#create&quot;</code></p> <h2 id="_4-3-實作討論群-瀏覽-功能"><a href="#_4-3-實作討論群-瀏覽-功能" class="header-anchor">#</a> 4-3 實作討論群“瀏覽”功能</h2> <h3 id="目標-3"><a href="#目標-3" class="header-anchor">#</a> 目標</h3> <ul><li>這一章我們要實作 討論群 的瀏覽功能</li></ul> <p>這時候如果直接點 index 上的 title 連結, 會跳出下面的錯誤訊息：</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-18-09.a51e205d.jpg" alt=""></p> <p>我們要修正這個問題，讓使用者可以瀏覽這個頁面</p> <h3 id="步驟-2"><a href="#步驟-2" class="header-anchor">#</a> 步驟</h3> <h4 id="step1-建立-show-action"><a href="#step1-建立-show-action" class="header-anchor">#</a> Step1: 建立 show action</h4> <p>在 app/controllers/groups_controller.rb 加入 show action</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/controllers/groups_controller.rb</span>
<span class="token keyword">class</span> <span class="token class-name">GroupsController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">index</span></span>
    <span class="token variable">@groups</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span>all
  <span class="token keyword">end</span>

<span class="token operator">+</span> <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">show</span></span>
<span class="token operator">+</span>   <span class="token variable">@group</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">+</span> <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">new</span></span>
    <span class="token variable">@group</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span><span class="token keyword">new</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">create</span></span>
    <span class="token variable">@group</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>group_params<span class="token punctuation">)</span>
    <span class="token variable">@group</span><span class="token punctuation">.</span>save

    redirect_to groups_path
  <span class="token keyword">end</span>

  <span class="token keyword">private</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">group_params</span></span>
    params<span class="token punctuation">.</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token symbol">:group</span><span class="token punctuation">)</span><span class="token punctuation">.</span>permit<span class="token punctuation">(</span><span class="token symbol">:title</span><span class="token punctuation">,</span> <span class="token symbol">:description</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><h4 id="step-2-加入-app-views-groups-show-html-erb"><a href="#step-2-加入-app-views-groups-show-html-erb" class="header-anchor">#</a> Step 2: 加入 app/views/groups/show.html.erb</h4> <p><code>touch app/views/groups/show.html.erb</code></p> <p>加入以下內容</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token comment">&lt;!-- app/views/groups/show.html.erb --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>row mt-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>col<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> <span class="token variable">@group</span><span class="token punctuation">.</span>title <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>col text-right<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> link_to<span class="token punctuation">(</span><span class="token string">&quot;Edit&quot;</span><span class="token punctuation">,</span> edit_group_path<span class="token punctuation">(</span><span class="token variable">@group</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">&quot;btn btn-primary&quot;</span><span class="token punctuation">)</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>col<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> <span class="token variable">@group</span><span class="token punctuation">.</span>description <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然後，當你瀏覽 http://localhost:3000/groups/1 時，頁面就會長這樣</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-27-38.e4c9f35c.jpg" alt=""></p> <h4 id="step-3-git-存檔-2"><a href="#step-3-git-存檔-2" class="header-anchor">#</a> Step 3 : git 存檔</h4> <p><code>git add .</code><br> <code>git commit -m &quot;implement groups#show&quot;</code></p> <h2 id="_4-4-實作討論群-編輯-功能"><a href="#_4-4-實作討論群-編輯-功能" class="header-anchor">#</a> 4-4 實作討論群“編輯”功能</h2> <h3 id="目標-4"><a href="#目標-4" class="header-anchor">#</a> 目標</h3> <ul><li>這一節我們要實作 討論群 的編輯功能</li></ul> <h3 id="步驟："><a href="#步驟：" class="header-anchor">#</a> 步驟：</h3> <h4 id="step-1-建立-edit-action"><a href="#step-1-建立-edit-action" class="header-anchor">#</a> Step 1. 建立 edit action</h4> <p>修改 app/controllers/groups_controller.rb 加入 edit action</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/controllers/groups_controller.rb</span>
<span class="token keyword">class</span> <span class="token class-name">GroupsController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span>

  <span class="token comment"># 略 ...</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">show</span></span>
    <span class="token variable">@group</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>

<span class="token operator">+</span> <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">edit</span></span>
<span class="token operator">+</span>  <span class="token variable">@group</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">+</span> <span class="token keyword">end</span>

  <span class="token comment"># 略 ...</span>

<span class="token keyword">end</span>
</code></pre></div><h4 id="step-2-建立-edit-action-的表單"><a href="#step-2-建立-edit-action-的表單" class="header-anchor">#</a> Step 2. 建立 edit action 的表單</h4> <p>新增 app/views/groups/edit.html.erb</p> <p><code>touch app/views/groups/edit.html.erb</code></p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token comment">&lt;!-- app/views/groups/edit.html.erb --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>row justify-content-center mt-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>col-5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>編輯討論版<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>

    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> form_for <span class="token variable">@group</span> <span class="token keyword">do</span> <span class="token operator">|</span>f<span class="token operator">|</span> <span class="token delimiter punctuation">%&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>form-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>group_title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>標題<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> f<span class="token punctuation">.</span>text_field <span class="token symbol">:title</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'form-control'</span> <span class="token delimiter punctuation">%&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>form-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>group_description<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>敘述<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> f<span class="token punctuation">.</span>text_area <span class="token symbol">:description</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'form-control'</span> <span class="token delimiter punctuation">%&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>form-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> f<span class="token punctuation">.</span>submit <span class="token string">&quot;Submit&quot;</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'btn btn-primary'</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span>disable_with<span class="token punctuation">:</span> <span class="token string">'Submitting...'</span><span class="token punctuation">}</span> <span class="token delimiter punctuation">%&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">end</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然後打開 <a href="http://localhost:3000/groups/1/edit" target="_blank" rel="noopener noreferrer">http://localhost:3000/groups/1/edit<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，可以見到成果</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-30-26.e51bfe6b.jpg" alt=""></p> <h4 id="step-3-git-存檔-3"><a href="#step-3-git-存檔-3" class="header-anchor">#</a> Step 3. git 存檔</h4> <p><code>git add .</code><br> <code>git commit -m &quot;implement groups#edit&quot;</code></p> <h4 id="step-4-實作-update-action"><a href="#step-4-實作-update-action" class="header-anchor">#</a> Step 4. 實作 update action</h4> <p>這時候我們可以嘗試修改裡面的數據，並試著送出。但是我們發現會跳出錯誤訊息，提醒我們 update 還沒實作：</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-32-15.6d8bd2a1.jpg" alt=""></p> <p>所以這時候，我們要實作 update action，接收 edit 裡的表單送出的訊息，真正更新存在數據庫裡的數據。</p> <p>修改 app/controllers/groups_controller.rb</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/controller/groups_controller.rb</span>
<span class="token keyword">class</span> <span class="token class-name">GroupsController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span>

    <span class="token comment"># ... 略</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">create</span></span>
    <span class="token variable">@group</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>group_params<span class="token punctuation">)</span>
    <span class="token variable">@group</span><span class="token punctuation">.</span>save

    redirect_to groups_path
  <span class="token keyword">end</span>

<span class="token operator">+</span> <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">update</span></span>
<span class="token operator">+</span>   <span class="token variable">@group</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">+</span>
<span class="token operator">+</span>   <span class="token variable">@group</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>group_params<span class="token punctuation">)</span>
<span class="token operator">+</span>
<span class="token operator">+</span>   redirect_to groups_path<span class="token punctuation">,</span> notice<span class="token punctuation">:</span> <span class="token string">&quot;Update Success&quot;</span>
<span class="token operator">+</span> <span class="token keyword">end</span>

  <span class="token comment"># ... 略</span>

<span class="token keyword">end</span>
</code></pre></div><p>然後試著更新一下數據，成功畫面應該會有“綠色”提示訊息。</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-35-23.178995d1.jpg" alt=""></p> <h4 id="step-5-git-存檔-2"><a href="#step-5-git-存檔-2" class="header-anchor">#</a> Step 5. git 存檔</h4> <p><code>git add .</code><br> <code>git commit -m &quot;implement groups#update&quot;</code></p> <h2 id="_4-5-實作討論群-刪除-功能"><a href="#_4-5-實作討論群-刪除-功能" class="header-anchor">#</a> 4-5 實作討論群“刪除”功能</h2> <h3 id="目標-5"><a href="#目標-5" class="header-anchor">#</a> 目標</h3> <ul><li>這一節我們要實作 討論群 的刪除功能</li></ul> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-40-22.62febb60.jpg" alt=""></p> <p>當我們點擊 delete 按鈕的時候, 會跳出下面的錯誤訊息</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-38-17.170f70b2.jpg" alt=""></p> <h3 id="步驟：-2"><a href="#步驟：-2" class="header-anchor">#</a> 步驟：</h3> <h4 id="step1-建立-delete-action"><a href="#step1-建立-delete-action" class="header-anchor">#</a> Step1. 建立 delete action</h4> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/controllers/groups_controller.rb</span>
  <span class="token comment"># .... 略</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">update</span></span>
    <span class="token variable">@group</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token variable">@group</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>group_params<span class="token punctuation">)</span>

    redirect_to groups_path<span class="token punctuation">,</span> notice<span class="token punctuation">:</span> <span class="token string">&quot;Update Success&quot;</span>
  <span class="token keyword">end</span>

<span class="token operator">+</span> <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">destroy</span></span>
<span class="token operator">+</span>   <span class="token variable">@group</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">+</span>   <span class="token variable">@group</span><span class="token punctuation">.</span>destroy
<span class="token operator">+</span>   flash<span class="token punctuation">[</span><span class="token symbol">:alert</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Group deleted&quot;</span>
<span class="token operator">+</span>   redirect_to groups_path
<span class="token operator">+</span> <span class="token keyword">end</span>
  <span class="token comment"># .... 略</span>
</code></pre></div><p>然後，按下刪除鍵之後，就可以把該筆記錄刪除。</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-41-43.5c97423f.jpg" alt=""></p> <p>如果成功的話，可以看到顯示“紅色”的訊息。</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-42-08.8a3b179a.jpg" alt=""></p> <h4 id="step-2-git-存檔"><a href="#step-2-git-存檔" class="header-anchor">#</a> Step 2. git 存檔</h4> <p><code>git add .</code><br> <code>git commit -m &quot;implement groups#destroy&quot;</code></p> <h2 id="_4-6-限制-標題為空-的group，不能被新增"><a href="#_4-6-限制-標題為空-的group，不能被新增" class="header-anchor">#</a> 4-6 限制“標題為空”的Group，不能被新增</h2> <h3 id="目標-6"><a href="#目標-6" class="header-anchor">#</a> 目標</h3> <ul><li>有時候我們會遇到使用者手殘，直接送出全空的表單，結果就出現空文章</li> <li>因此我們要加上一個限制，讓使用者不能送出“空標題”文章才對</li></ul> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-11-10.c4276cb7.jpg" alt=""></p> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-45-40.b4f07c0f.jpg" alt=""></p> <h3 id="步驟-3"><a href="#步驟-3" class="header-anchor">#</a> 步驟</h3> <h4 id="step-1-在-group-model-加入-標題限制"><a href="#step-1-在-group-model-加入-標題限制" class="header-anchor">#</a> Step 1: 在 Group model 加入“標題限制”</h4> <p>修改 app/models/group.rb 讓它長得像這樣</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/models/group.rb</span>
<span class="token keyword">class</span> <span class="token class-name">Group</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationRecord</span>
  validates <span class="token symbol">:title</span><span class="token punctuation">,</span> presence<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token keyword">end</span>
</code></pre></div><p>這樣一來，就算送出了空的表單，也不會產生任何紀錄。</p> <p>但我們真正希望達到的效果是像這樣子的，送出了空表單，使用者能夠確切地知道，自己是因為什麼錯誤被攔下：</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_23-00-08.216001f3.jpg" alt=""></p> <h4 id="step-2-在-groups-controller-裡面加入儲存失敗的判斷"><a href="#step-2-在-groups-controller-裡面加入儲存失敗的判斷" class="header-anchor">#</a> Step 2: 在 groups_controller 裡面加入儲存失敗的判斷</h4> <p>修改 app/controllers/groups_controller.rb</p> <p>將 create action 修改成這樣：</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/controllers/groups_controller.rb</span>
<span class="token keyword">def</span> <span class="token method-definition"><span class="token function">create</span></span>
  <span class="token variable">@group</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>group_params<span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token variable">@group</span><span class="token punctuation">.</span>save
    redirect_to groups_path
  <span class="token keyword">else</span>
    render <span class="token symbol">:new</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>然後修改 app/views/groups/new.html.erb</p> <p>在 form_for 下方加入這一段：</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_22-59-32.2d479f0c.jpg" alt=""></p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token comment">&lt;!-- app/views/groups/new.html.erb --&gt;</span>
<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">if</span> <span class="token variable">@group</span><span class="token punctuation">.</span>errors<span class="token punctuation">.</span>any<span class="token operator">?</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>alert alert-danger<span class="token punctuation">&quot;</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>alert<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token variable">@group</span><span class="token punctuation">.</span>errors<span class="token punctuation">.</span>full_messages<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>msg<span class="token operator">|</span> <span class="token delimiter punctuation">%&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> msg <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">end</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">end</span> <span class="token delimiter punctuation">%&gt;</span></span>
</code></pre></div><p>然後就可以產生這樣的效果</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_23-00-08.216001f3.jpg" alt=""></p> <h4 id="step-3-git-存檔-4"><a href="#step-3-git-存檔-4" class="header-anchor">#</a> Step 3 : git 存檔</h4> <p><code>git add .</code><br> <code>git commit -m &quot;add validation to title&quot;</code></p> <h4 id="step-4-修改-edit-action"><a href="#step-4-修改-edit-action" class="header-anchor">#</a> Step 4 : 修改 edit action</h4> <p>還有一種情況是，在修改時，把標題改成空白的。<br>
所以我們也要避免這樣的情況發生。</p> <p>修改 app/controllers/groups_controller.rb，的 update action 讓他長得像這樣</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/controllers/groups_controller.rb</span>
<span class="token keyword">def</span> <span class="token method-definition"><span class="token function">update</span></span>
  <span class="token variable">@group</span> <span class="token operator">=</span> <span class="token constant">Group</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token variable">@group</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>group_params<span class="token punctuation">)</span>
    redirect_to groups_path<span class="token punctuation">,</span> notice<span class="token punctuation">:</span> <span class="token string">&quot;Update Success&quot;</span>
  <span class="token keyword">else</span>
    render <span class="token symbol">:edit</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>然後修改 app/views/groups/edit.html.erb</p> <p>也在 form_for 下方加入這一段：</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_23-01-00.e48b5d87.jpg" alt=""></p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token comment">&lt;!-- app/views/groups/edit.html.erb --&gt;</span>
<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">if</span> <span class="token variable">@group</span><span class="token punctuation">.</span>errors<span class="token punctuation">.</span>any<span class="token operator">?</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>alert alert-danger<span class="token punctuation">&quot;</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>alert<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token variable">@group</span><span class="token punctuation">.</span>errors<span class="token punctuation">.</span>full_messages<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>msg<span class="token operator">|</span> <span class="token delimiter punctuation">%&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> msg <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">end</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">end</span> <span class="token delimiter punctuation">%&gt;</span></span>
</code></pre></div><p>這樣，在“編輯”時，也有一樣的效果。</p> <h4 id="step-5-git-存檔-3"><a href="#step-5-git-存檔-3" class="header-anchor">#</a> Step 5 : git 存檔</h4> <p><code>git add .</code><br> <code>git commit -m &quot;add validation to title apply to edit/update&quot;</code></p> <div class="custom-block tip"><p class="custom-block-title">本節常見問題</p> <p><code>validates :title, presence: true</code> 是什麼意思</p> <ul><li>這是 Rails 的 Model 內建的“驗證”函式。意思是“不得為空”。</li> <li>其實 Rails 還有很多內建驗質函式，你可以看這裡：<a href="http://guides.rubyonrails.org/active_record_validations.html" target="_blank" rel="noopener noreferrer">http://guides.rubyonrails.org/active_record_validations.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <h2 id="_4-7-共用-表單"><a href="#_4-7-共用-表單" class="header-anchor">#</a> 4-7 共用“表單”</h2> <h3 id="目標-7"><a href="#目標-7" class="header-anchor">#</a> 目標</h3> <ul><li>把 new 與 edit 重複的表單程式碼，抽成一個共用文件</li></ul> <p>我們觀察到，new 與 edit 都有相同的“表單程式碼”，顯得相當累贅。在這裡我們可以利用一個 Rails  內建的架構  partial去整理設計。</p> <h3 id="步驟-4"><a href="#步驟-4" class="header-anchor">#</a> 步驟</h3> <h4 id="step-1-產生-app-views-groups-form-html-erb"><a href="#step-1-產生-app-views-groups-form-html-erb" class="header-anchor">#</a> Step 1: 產生 app/views/groups/_form.html.erb</h4> <p><code>touch app/views/groups/_form.html.erb</code></p> <p>填入以下內容：</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token comment">&lt;!-- app/views/groups/_form.html.erb --&gt;</span>
<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> form_for <span class="token variable">@group</span> <span class="token keyword">do</span> <span class="token operator">|</span>f<span class="token operator">|</span> <span class="token delimiter punctuation">%&gt;</span></span>

  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">if</span> <span class="token variable">@group</span><span class="token punctuation">.</span>errors<span class="token punctuation">.</span>any<span class="token operator">?</span> <span class="token delimiter punctuation">%&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>alert alert-danger<span class="token punctuation">&quot;</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>alert<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token variable">@group</span><span class="token punctuation">.</span>errors<span class="token punctuation">.</span>full_messages<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>msg<span class="token operator">|</span> <span class="token delimiter punctuation">%&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> msg <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
      <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">end</span> <span class="token delimiter punctuation">%&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">end</span> <span class="token delimiter punctuation">%&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>form-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>group_title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>標題<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> f<span class="token punctuation">.</span>text_field <span class="token symbol">:title</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'form-control'</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>form-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>group_description<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>敘述<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> f<span class="token punctuation">.</span>text_area <span class="token symbol">:description</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'form-control'</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>form-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> f<span class="token punctuation">.</span>submit <span class="token string">&quot;Submit&quot;</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'btn btn-primary'</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span>disable_with<span class="token punctuation">:</span> <span class="token string">'Submitting...'</span><span class="token punctuation">}</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">end</span> <span class="token delimiter punctuation">%&gt;</span></span>
</code></pre></div><h4 id="step-2-修改-app-views-groups-new-html-erb"><a href="#step-2-修改-app-views-groups-new-html-erb" class="header-anchor">#</a> Step 2: 修改 app/views/groups/new.html.erb</h4> <p>修改 app/views/groups/new.html.erb，把原先重複的表單程式碼“整段刪掉”，改成 &lt;%= render &quot;form&quot; %&gt;</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token comment">&lt;!-- app/views/groups/new.html.erb --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>row justify-content-center mt-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>col-5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>新增討論版<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>

    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> render <span class="token string">&quot;form&quot;</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="step-3-修改-app-views-groups-edit-html-erb"><a href="#step-3-修改-app-views-groups-edit-html-erb" class="header-anchor">#</a> Step 3: 修改 app/views/groups/edit.html.erb</h4> <p>修改 app/views/groups/edit.html.erb，把原先重複的表單源程式碼“整段刪掉”，改成 <code>&lt;%= render &quot;form&quot; %&gt;</code></p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token comment">&lt;!-- app/views/groups/edit.html.erb --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>row justify-content-center mt-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>col-5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>編輯討論版<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>

    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> render <span class="token string">&quot;form&quot;</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="step-4-git-存檔"><a href="#step-4-git-存檔" class="header-anchor">#</a> Step 4: git 存檔</h4> <p><code>git add .</code><br> <code>git commit -m &quot;move form to partial&quot;</code></p> <div class="custom-block tip"><p class="custom-block-title">本節常見問題</p> <p>教材裡的render &quot;form&quot;是什麼意思？<br>
其實這是 <code>&lt;%= render :partial =&gt; &quot;form&quot; %&gt;</code> 的“縮寫”，意思是我要引用 Partial (局部）頁面的方式。因為我們發現有很大量的程式碼重複，所以可以用這樣的方式收納。</p> <p>它的規則是同目錄底下的 _xxxx.html.erb</p></div> <h2 id="_4-8-使用-simpleform-簡化表單"><a href="#_4-8-使用-simpleform-簡化表單" class="header-anchor">#</a> 4-8 使用 SimpleForm 簡化表單</h2> <h3 id="目標-8"><a href="#目標-8" class="header-anchor">#</a> 目標</h3> <ul><li>將表單換為 SimpleForm</li></ul> <h4 id="step-1-安裝-simpleform"><a href="#step-1-安裝-simpleform" class="header-anchor">#</a> Step 1: 安裝 SimpleForm</h4> <p>在這張表單 HTML 中，我們見到很囉唆的語句：</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>form-group string optional<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> f<span class="token punctuation">.</span>label <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">&quot;string optional control-label&quot;</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> f<span class="token punctuation">.</span>text_field <span class="token symbol">:title</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">&quot;string optional form-control&quot;</span> <span class="token delimiter punctuation">%&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然後每一個欄位，都必須要用 bootstrap 指定的樣式，重新裝潢。但是如此一來，要是在欄位很多時，要寫的 HTML 就要寫上不少。有沒有方法可以簡化呢？</p> <p>這邊我們要介紹一個 gem 叫做 simple_form，它可以幫你簡化複雜的表單這件事。</p> <p>首先我們要來安裝 simple_form</p> <p>打開 Gemfile，然後新增一行 gem 'simple_form'</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># Gemfile</span>
<span class="token operator">+</span> gem <span class="token string">'simple_form'</span>
</code></pre></div><p>然後執行 <code>bundle install</code> 安裝 gem。</p> <h4 id="step-2-安裝-simple-form-for-bootstrap-的設定"><a href="#step-2-安裝-simple-form-for-bootstrap-的設定" class="header-anchor">#</a> Step 2: 安裝 simple_form for bootstrap 的設定</h4> <p>執行：</p> <p><code>rails generate simple_form:install --bootstrap</code></p> <p><img src="/notepad/assets/img/Xnip2020-08-22_23-42-37.af5c3634.jpg" alt=""></p> <p>然後重開 rails server（ 按 ctrl＋c 終止 rails server， 再執行 <code>rails s</code>）</p> <p>這個指令會產生兩個文件</p> <ul><li>config/initializers/simple_form.rb</li> <li>config/initializers/simple_form_bootstrap.rb （這個是 Bootstrap 表單的“佈景”)</li></ul> <h4 id="step-3-修改-app-views-groups-form-html-erb"><a href="#step-3-修改-app-views-groups-form-html-erb" class="header-anchor">#</a> Step 3: 修改 app/views/groups/_form.html.erb</h4> <p>把內容改成</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token comment">&lt;!-- app/views/groups/_form.html.erb --&gt;</span>
<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> simple_form_for <span class="token variable">@group</span> <span class="token keyword">do</span> <span class="token operator">|</span>f<span class="token operator">|</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>form-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> f<span class="token punctuation">.</span>input <span class="token symbol">:title</span> <span class="token delimiter punctuation">%&gt;</span></span>
    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> f<span class="token punctuation">.</span>input <span class="token symbol">:description</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> f<span class="token punctuation">.</span>submit <span class="token string">&quot;Submit&quot;</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'btn btn-primary'</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span>disable_with<span class="token punctuation">:</span> <span class="token string">'Submitting...'</span><span class="token punctuation">}</span> <span class="token delimiter punctuation">%&gt;</span></span>
<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">end</span> <span class="token delimiter punctuation">%&gt;</span></span>
</code></pre></div><p>然後打開 http://localhost:3000/groups/new 就可以看到這樣的成果了。更棒的是 simple_form 提供的錯誤訊息，直接是在欄位旁邊的。更明顯更直觀。</p> <p><img src="/notepad/assets/img/Xnip2020-08-22_23-49-35.227477d5.jpg" alt=""></p> <h4 id="step-4-git-存檔-2"><a href="#step-4-git-存檔-2" class="header-anchor">#</a> Step 4: git 存檔</h4> <p><code>git add .</code><br> <code>git commit -m &quot;replace form with simple_form bootstrap template&quot;</code></p> <h2 id="_4-9（解說）rails-的-crud-與-restful"><a href="#_4-9（解說）rails-的-crud-與-restful" class="header-anchor">#</a> 4-9（解說）Rails 的 CRUD 與 RESTful</h2> <p>如果你還在做第一遍練習時，請跳過這整章解說，否則你大腦會亂掉！<br>
如果你還在做第一遍練習時，請跳過這整章解說，否則你大腦會亂掉！<br>
如果你還在做第一遍練習時，請跳過這整章解說，否則你大腦會亂掉！</p> <ul><li>叫你滾出去還不明白嗎？</li> <li>叫你滾出去還不明白嗎？</li> <li>叫你滾出去還不明白嗎？</li></ul> <p>好。我現在確定你應該已經是做第二遍了，才看這一篇解說的。</p> <h3 id="http-請求-request）與-http-動作-verb）"><a href="#http-請求-request）與-http-動作-verb）" class="header-anchor">#</a> HTTP 請求( Request）與 HTTP 動作 ( Verb）</h3> <p>一般網頁的運作原理是這樣的：</p> <ol><li>使用者在瀏覽器輸入了某個網址，點擊了某個連結。這都叫發出 HTTP 請求 (Request）。</li> <li>而瀏覽器回應之後：產生頁面，或者是重新導向。這都叫 HTTP 回應（Response）。</li></ol> <p>一般來說，使用者最常使用的是兩種類型 / 動作 ( Verb )的請求： GET 與 POST。</p> <ul><li>GET ：輸入網址，點擊某些網址。這都是 GET。</li> <li>POST：送出表單。這叫做 POST</li></ul> <h3 id="restful-的基礎概念"><a href="#restful-的基礎概念" class="header-anchor">#</a> RESTful 的基礎概念</h3> <p>因為 CRUD 是常見的操作行為，但是大家實作的方式、與網址設計方式不一樣。造成很多維護上的困擾。</p> <p>後來就有人發明 RESTful 這個概念，希望用 HTTP 的動作 ( Verb）一起去封裝 CRUD 的行為。所以又多加了兩個動作：</p> <ul><li>PUT : 更新 ( update )</li> <li>DELETE : 刪除 ( delete）</li></ul> <p>而 Rails 的 Routing 也是依循這樣的理念去設計。</p> <p><img src="/notepad/assets/img/Xnip2020-08-23_00-10-56.a957b568.jpg" alt=""></p> <h3 id="rails-的基礎-restful概念"><a href="#rails-的基礎-restful概念" class="header-anchor">#</a> Rails 的基礎 RESTful概念</h3> <p>由於RESTful是個新手不容易一下子理解的概念，號稱學 Ruby on Rails 初期最大障礙。</p> <p>在本篇儘量用淺顯易懂的方式解釋。如果看不懂也沒關係，用背的！！</p> <p>一定要背起來！</p> <p><img src="/notepad/assets/img/Xnip2020-08-23_00-12-00.6dc6073d.jpg" alt=""></p> <h3 id="以下例子以-第三章，-做出-crud-功能的討論版來解釋："><a href="#以下例子以-第三章，-做出-crud-功能的討論版來解釋：" class="header-anchor">#</a> 以下例子以 第三章， 做出 CRUD 功能的討論版來解釋：</h3> <ul><li>討論版有個群組叫： groups。在 Restful 的概念裡把這個 groups 叫做 resources，“一組資源”的意思。</li></ul> <p>為了要控制它的運作，我們會創建一個新的 Controller文件 叫做 groups_controller.rb</p> <p>HTTP Verb 有四種：</p> <ul><li>新增 (create，使用 POST )</li> <li>讀取 (read，使用 GET )</li> <li>更新 (update，使用 PUT )</li> <li>刪除 (destroy，使用 DELETE)</li></ul> <p>在這組 controller 當中，我們會實作 7 個 Action ，4 張頁面。</p> <ul><li>首頁( index )：用來列出所有的討論版，可以選擇各個單版 （使用 GET )</li> <li>各個討論版專屬頁面(show)：顯示討論版版名跟簡介 (使用 GET )</li> <li>新增頁面(new)：裡面會有表單，填完以後可以送出 (使用 GET )</li> <li>產生數據（create) ：new 送出來的表單到 create 這個 action，新增一筆數據 ( 使用 POST )</li> <li>編輯頁面(edit)：裡面會有表單呈現現有數據來，填完數據後可以送出 (使用 GET )</li> <li>更新數據（update)：edit 送出來的表單可以到 update 這個 action，更新該筆數據 (使用 PUT )</li> <li>刪除數據：送出刪除請求，刪除該筆數據（使用 DELETE）</li></ul> <p>這七個 action ，是每個CRUD功能裡最基本的動作。只要我們在 controller.rb 裡定義 (def) 好這七個方法當作動作 (action)。其他的部分 Rails 就會幫我們處理了。</p> <p>像是設定 Routing (路由) 只需要簡單一行:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># config/routes.rb</span>
resources <span class="token symbol">:groups</span>
</code></pre></div><p>這樣不管瀏覽器端跑來什麼樣的請求 (request) ，Routing都會聰明地幫我們導向正確的 action 去運作後續流程。</p> <h3 id="網址對應關係"><a href="#網址對應關係" class="header-anchor">#</a> 網址對應關係</h3> <p>對於網址跟對應的Action與頁面來說</p> <ul><li>/groups/ 一定就是 index，首頁，對應Routes路徑： groups_path</li> <li>/groups/123 一定就是 show，名字為123的討論版個版頁面，對應Routes路徑： group_path(123)</li> <li>/groups/123/edit 一定就是 edit，編輯討論版123的表單頁面，對應Routes路徑：edit_group_path(123)</li> <li>/groups/new 一定就是 new，新增討論版的表單頁面，對應Routes路徑(或稱為helper)：new_group_path</li></ul> <h3 id="總結"><a href="#總結" class="header-anchor">#</a> 總結</h3> <p>所以製作一個 RESTful 風格的討論版，我們僅需在Routes設定一行程式碼即可</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最後更新時間:</span> <span class="time">2020-8-23 0:15:46</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notepad/fullstack-camp/03-03.html" class="prev">
        3-建立一個討論群組
      </a></span> <span class="next"><a href="/notepad/fullstack-camp/03-05.html">
        5-加入使用者功能
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notepad/assets/js/app.abc900cd.js" defer></script><script src="/notepad/assets/js/2.de767da7.js" defer></script><script src="/notepad/assets/js/4.f36ccaf5.js" defer></script>
  </body>
</html>
