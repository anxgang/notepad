<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3-初探 Rails | notepad</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/notepad/favicon.ico">
    <meta name="description" content="一個小小筆記本">
    <link rel="preload" href="/notepad/assets/css/0.styles.e4f7a2f2.css" as="style"><link rel="preload" href="/notepad/assets/js/app.abc900cd.js" as="script"><link rel="preload" href="/notepad/assets/js/2.de767da7.js" as="script"><link rel="preload" href="/notepad/assets/js/3.b28a5640.js" as="script"><link rel="prefetch" href="/notepad/assets/js/10.b2c06949.js"><link rel="prefetch" href="/notepad/assets/js/11.c9e2691f.js"><link rel="prefetch" href="/notepad/assets/js/12.63f79b42.js"><link rel="prefetch" href="/notepad/assets/js/13.f7af4e8d.js"><link rel="prefetch" href="/notepad/assets/js/14.31b24aa9.js"><link rel="prefetch" href="/notepad/assets/js/15.ee275869.js"><link rel="prefetch" href="/notepad/assets/js/16.baece4fe.js"><link rel="prefetch" href="/notepad/assets/js/17.40bc1197.js"><link rel="prefetch" href="/notepad/assets/js/18.1c6f3d85.js"><link rel="prefetch" href="/notepad/assets/js/19.ffd304a8.js"><link rel="prefetch" href="/notepad/assets/js/20.d16e10f7.js"><link rel="prefetch" href="/notepad/assets/js/21.9bf663a6.js"><link rel="prefetch" href="/notepad/assets/js/22.a96f91d1.js"><link rel="prefetch" href="/notepad/assets/js/23.d82ddc41.js"><link rel="prefetch" href="/notepad/assets/js/24.cbdef2f9.js"><link rel="prefetch" href="/notepad/assets/js/25.236bf007.js"><link rel="prefetch" href="/notepad/assets/js/26.42754cbe.js"><link rel="prefetch" href="/notepad/assets/js/27.69e3f6e3.js"><link rel="prefetch" href="/notepad/assets/js/28.917a0ffd.js"><link rel="prefetch" href="/notepad/assets/js/29.a5dfebe9.js"><link rel="prefetch" href="/notepad/assets/js/30.f3254c32.js"><link rel="prefetch" href="/notepad/assets/js/31.3671faaa.js"><link rel="prefetch" href="/notepad/assets/js/32.156d06d3.js"><link rel="prefetch" href="/notepad/assets/js/33.82cadb70.js"><link rel="prefetch" href="/notepad/assets/js/34.c1b3533d.js"><link rel="prefetch" href="/notepad/assets/js/35.14bbedca.js"><link rel="prefetch" href="/notepad/assets/js/36.1d786d21.js"><link rel="prefetch" href="/notepad/assets/js/37.ae49daca.js"><link rel="prefetch" href="/notepad/assets/js/38.14c91a38.js"><link rel="prefetch" href="/notepad/assets/js/39.949464aa.js"><link rel="prefetch" href="/notepad/assets/js/4.f36ccaf5.js"><link rel="prefetch" href="/notepad/assets/js/40.ac472316.js"><link rel="prefetch" href="/notepad/assets/js/41.2aa5b49e.js"><link rel="prefetch" href="/notepad/assets/js/42.082133ed.js"><link rel="prefetch" href="/notepad/assets/js/43.2c454234.js"><link rel="prefetch" href="/notepad/assets/js/44.3e01dbc8.js"><link rel="prefetch" href="/notepad/assets/js/45.c1b3a767.js"><link rel="prefetch" href="/notepad/assets/js/46.1b528671.js"><link rel="prefetch" href="/notepad/assets/js/47.fa275e25.js"><link rel="prefetch" href="/notepad/assets/js/48.82431801.js"><link rel="prefetch" href="/notepad/assets/js/49.26b95970.js"><link rel="prefetch" href="/notepad/assets/js/5.d8810cd1.js"><link rel="prefetch" href="/notepad/assets/js/50.080a8b89.js"><link rel="prefetch" href="/notepad/assets/js/51.eb4ba65f.js"><link rel="prefetch" href="/notepad/assets/js/52.9b2ec4b6.js"><link rel="prefetch" href="/notepad/assets/js/53.b9291662.js"><link rel="prefetch" href="/notepad/assets/js/54.adf368fd.js"><link rel="prefetch" href="/notepad/assets/js/55.7b43fc99.js"><link rel="prefetch" href="/notepad/assets/js/56.40f4e551.js"><link rel="prefetch" href="/notepad/assets/js/57.283e1e67.js"><link rel="prefetch" href="/notepad/assets/js/58.60dd1afe.js"><link rel="prefetch" href="/notepad/assets/js/59.f1434f61.js"><link rel="prefetch" href="/notepad/assets/js/6.466d8455.js"><link rel="prefetch" href="/notepad/assets/js/7.f05a3669.js"><link rel="prefetch" href="/notepad/assets/js/8.5d885b12.js"><link rel="prefetch" href="/notepad/assets/js/9.5e35ba9f.js">
    <link rel="stylesheet" href="/notepad/assets/css/0.styles.e4f7a2f2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notepad/" class="home-link router-link-active"><!----> <span class="site-name">notepad</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notepad/git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/notepad/ruby/" class="nav-link">
  Ruby
</a></div><div class="nav-item"><a href="/notepad/rails/" class="nav-link">
  Rails
</a></div><div class="nav-item"><a href="/notepad/javascript/" class="nav-link">
  Javascript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="More" class="dropdown-title"><span class="title">More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notepad/roadmap/" class="nav-link">
  開發者路線指引
</a></li><li class="dropdown-item"><!----> <a href="/notepad/basic-for-web-developers/" class="nav-link">
  網頁基礎(HTML&amp;CSS)
</a></li><li class="dropdown-item"><!----> <a href="/notepad/fullstack-camp/" class="nav-link router-link-active">
  全棧營(Rails101)
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notepad/git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/notepad/ruby/" class="nav-link">
  Ruby
</a></div><div class="nav-item"><a href="/notepad/rails/" class="nav-link">
  Rails
</a></div><div class="nav-item"><a href="/notepad/javascript/" class="nav-link">
  Javascript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="More" class="dropdown-title"><span class="title">More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notepad/roadmap/" class="nav-link">
  開發者路線指引
</a></li><li class="dropdown-item"><!----> <a href="/notepad/basic-for-web-developers/" class="nav-link">
  網頁基礎(HTML&amp;CSS)
</a></li><li class="dropdown-item"><!----> <a href="/notepad/fullstack-camp/" class="nav-link router-link-active">
  全棧營(Rails101)
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第零課、入學手冊</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第一課、環境建置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>第二課、初級練習</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notepad/fullstack-camp/02-01.html" class="sidebar-link">1-教材介紹</a></li><li><a href="/notepad/fullstack-camp/02-02.html" class="sidebar-link">2-Ruby 程式語言</a></li><li><a href="/notepad/fullstack-camp/02-03.html" aria-current="page" class="active sidebar-link">3-初探 Rails</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/02-03.html#_3-1-開始吧！" class="sidebar-link">3-1 開始吧！</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/02-03.html#_3-2-把專案加進-git-repo" class="sidebar-link">3-2 把專案加進 Git Repo</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/02-03.html#_3-3-在本機執行你的程式" class="sidebar-link">3-3 在本機執行你的程式</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/02-03.html#_3-4-建立-migration" class="sidebar-link">3-4 建立 Migration</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/02-03.html#_3-5-crud-和-scaffolding" class="sidebar-link">3-5 CRUD 和 Scaffolding</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/02-03.html#_3-6-設定首頁" class="sidebar-link">3-6 設定首頁</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/02-03.html#_3-7-對-topic-投票" class="sidebar-link">3-7 對 Topic 投票</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/02-03.html#_3-8-把投票記錄和-topics-接起來" class="sidebar-link">3-8 把投票記錄和 Topics 接起來</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/02-03.html#_3-9-讓大家可以投票" class="sidebar-link">3-9 讓大家可以投票</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/02-03.html#_3-10-新增後能夠回到-topics-列表" class="sidebar-link">3-10 新增後能夠回到 topics 列表</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/02-03.html#_3-11-把-topic-標題變成可以點選的超連結" class="sidebar-link">3-11 把 Topic 標題變成可以點選的超連結</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/02-03.html#_3-12-清理-topics-列表" class="sidebar-link">3-12 清理 Topics 列表</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/02-03.html#_3-13-加分題-下一步" class="sidebar-link">3-13 加分題 &amp; 下一步</a></li><li class="sidebar-sub-header"><a href="/notepad/fullstack-camp/02-03.html#_3-14-賀！你剛-完成-了你的第一個-rails-程式！" class="sidebar-link">3-14 賀！你剛“完成”了你的第一個 Rails 程式！</a></li></ul></li><li><a href="/notepad/fullstack-camp/02-04.html" class="sidebar-link">4-補充教材</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第三課、Rails101</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_3-初探-rails"><a href="#_3-初探-rails" class="header-anchor">#</a> 3-初探 Rails</h1> <blockquote><p>預計學習時間: 4小時</p></blockquote> <h2 id="_3-1-開始吧！"><a href="#_3-1-開始吧！" class="header-anchor">#</a> 3-1 開始吧！</h2> <p><img src="/notepad/assets/img/Xnip2020-08-07_23-15-55.d5cfdc04.jpg" alt=""></p> <h3 id="目標"><a href="#目標" class="header-anchor">#</a> 目標</h3> <p>建立你的 New Application</p> <p>來，開始吧！在這一步驟的最後，我們會得到一個全新的（空白）Rails 應用程式。</p> <h3 id="步驟"><a href="#步驟" class="header-anchor">#</a> 步驟</h3> <h4 id="步驟-1"><a href="#步驟-1" class="header-anchor">#</a> 步驟 1</h4> <p>cd 的意思是切換目錄（<strong>C</strong>hange <strong>D</strong>irectory）</p> <p>在終端機打這些字 ( Mac 或 Linux )</p> <div class="language- extra-class"><pre class="language-text"><code>cd ~
</code></pre></div><p>cd ~ 切換（當前位置）到home目錄</p> <h4 id="步驟-2"><a href="#步驟-2" class="header-anchor">#</a> 步驟 2</h4> <p>在終端機打這些字：</p> <div class="language- extra-class"><pre class="language-text"><code>mkdir railsbridge
</code></pre></div><p>這會新增一個資料夾，讓我們把專案放在裡面。</p> <h4 id="步驟-3"><a href="#步驟-3" class="header-anchor">#</a> 步驟 3</h4> <p>在終端機打這些字：</p> <div class="language- extra-class"><pre class="language-text"><code>cd railsbridge
</code></pre></div><h4 id="步驟-4"><a href="#步驟-4" class="header-anchor">#</a> 步驟 4</h4> <p>確定一下你有沒有之前練習用的程式碼在裡面。</p> <p>在終端機打這些字：</p> <div class="language- extra-class"><pre class="language-text"><code>ls
</code></pre></div><p>這指令會列出 railsbridge 資料夾裡面的檔案。如果列出了舊的 suggestotron 應用程式，你可以刪掉它們來避免干擾：</p> <p>在終端機打這些字：</p> <div class="language- extra-class"><pre class="language-text"><code>rm -rf suggestotron
</code></pre></div><h4 id="步驟-5"><a href="#步驟-5" class="header-anchor">#</a> 步驟 5</h4> <p>在終端機打這些字：</p> <div class="language- extra-class"><pre class="language-text"><code>rails new suggestotron
</code></pre></div><p>rails new 會用你給的名字來建立新的 Rails 專案</p> <p>這次我們建一個新的專案叫 suggestotron 。我們馬上就會詳述它到底建立了什麼。</p> <h4 id="步驟-6"><a href="#步驟-6" class="header-anchor">#</a> 步驟 6</h4> <p>在終端機打這些字：</p> <div class="language- extra-class"><pre class="language-text"><code>cd suggestotron
</code></pre></div><p>cd 指的是切換目錄 (<strong>c</strong>hange <strong>d</strong>irectory)。</p> <p>cd suggestotron 切換到 suggestotron 做為成當前資料夾。</p> <h4 id="步驟-7"><a href="#步驟-7" class="header-anchor">#</a> 步驟 7</h4> <p>在終端機打這些字：</p> <div class="language- extra-class"><pre class="language-text"><code>ls
</code></pre></div><p>ls 指的是列出東西 (<strong>l</strong>ist <strong>s</strong>tuff)。</p> <p>它會把目前資料夾的內容列出來給你看。</p> <h4 id="步驟-8"><a href="#步驟-8" class="header-anchor">#</a> 步驟 8</h4> <p>執行 VSCode 編輯器，用專案的方式打開 suggestotron 資料夾。</p> <p>選擇 <code>檔案 &gt; 開啟工作區</code>。</p> <p><img src="/notepad/assets/img/Xnip2020-08-07_22-51-45.df406500.jpg" alt=""></p> <p><img src="/notepad/assets/img/Xnip2020-08-07_22-51-25.c9021c63.jpg" alt=""></p> <p>在右上角輸入 suggestotron ，電腦會找到這給資料夾，點擊選擇它，如果一切沒問題的話，VSCode 會在視窗左邊以樹狀結構列出資料夾的內容：</p> <p><img src="/notepad/assets/img/Xnip2020-08-07_22-53-19.155d7f88.jpg" alt=""></p> <p>你會發現 rails new 開了一大堆資料夾和檔案。今天我們要看的是這些：</p> <table><thead><tr><th>檔案/資料夾</th> <th>用途</th></tr></thead> <tbody><tr><td><strong>app/</strong></td> <td>包含你應用程式的 controllers、models、views。你要改的東西大多是這些。</td></tr> <tr><td><strong>config/</strong></td> <td>設定應用程式的執行階段規則、路由設定（routes）、資料庫等等。</td></tr> <tr><td><strong>db/</strong></td> <td>顯示你目前資料庫的 schema（結構定義），以及資料庫的 migrations。</td></tr> <tr><td><strong>public/</strong></td> <td>這是唯一一個資料夾會是放什麼就出現什麼的。如果你把檔案放裡面，server 會直接回傳，不會經過 Rails 的處理。</td></tr> <tr><td><strong>app/javascript/</strong></td> <td>你會要把圖片、JavaScript、stylesheets (CSS) 還有其他靜態檔案放在裡面。現代的 Rails 應用程式使用名為 Webpack 的前端打包工具，他能把在這資料夾裡面的所有 JavaScript 和 CSS 檔合併成一個檔案來加速。</td></tr></tbody></table> <p>rails new 還建立了其他很多東西。大概可以寫一本書來講，所以我們現在先無視它們。</p> <h2 id="_3-2-把專案加進-git-repo"><a href="#_3-2-把專案加進-git-repo" class="header-anchor">#</a> 3-2 把專案加進 Git Repo</h2> <h3 id="目標-2"><a href="#目標-2" class="header-anchor">#</a> 目標</h3> <ul><li>建一個本地的 git repository（倉庫）</li> <li>把所有檔案加入 git repository</li></ul> <p>為了把我們的應用程式發佈到網絡上，我們要把我們的程式和過程中的修改都加到“版本控制系統”。我們會用 git ，因為它比較簡單，而且 Heroku 也用它。</p> <h3 id="步驟-9"><a href="#步驟-9" class="header-anchor">#</a> 步驟</h3> <h4 id="步驟-1-2"><a href="#步驟-1-2" class="header-anchor">#</a> 步驟 1</h4> <p>請用下面指令，確認你在 suggestotron 目錄裡</p> <div class="language- extra-class"><pre class="language-text"><code>pwd
</code></pre></div><p>在終端機打這些字：</p> <div class="language- extra-class"><pre class="language-text"><code>git init
</code></pre></div><p><img src="/notepad/assets/img/Xnip2020-08-07_23-02-03.2f651bf9.jpg" alt=""></p> <p>git init 初始化 git 的意思，他會把相關資料放在 .git 的資料夾中，
你也可以輸入 <code>ls -a</code>(列出所有檔案包含隱藏檔案) 來查看它。</p> <h4 id="步驟-2-2"><a href="#步驟-2-2" class="header-anchor">#</a> 步驟 2</h4> <p>在終端機打這些字：</p> <p><code>git status</code></p> <p><img src="/notepad/assets/img/Xnip2020-08-07_23-07-07.7c0f1e4e.jpg" alt=""></p> <p>git status 會告訴你 git 所見所有改過、新增、刪掉的東西。</p> <p>第一次跑這個指令的時候，會看到很多東西。</p> <p>第二次跑這個指令的時候，你不會看到很多東西。</p> <h4 id="步驟-3-2"><a href="#步驟-3-2" class="header-anchor">#</a> 步驟 3</h4> <p>在終端機打這些字：</p> <div class="language- extra-class"><pre class="language-text"><code>git add .
</code></pre></div><p>git add . 告訴 git 你想要把目前資料夾（即 .）還有它底下的所有東西加進 repo。</p> <p>在 Git 裡，有多個指令可以做到類似的事：</p> <ul><li><code>git add foo.txt</code> 把名叫 foo.txt 的檔案加進追蹤修訂。</li> <li><code>git add .</code> 把所有新檔案和改過的檔案加進追蹤修訂，包含你刪掉的檔案。</li></ul> <h4 id="步驟-4-2"><a href="#步驟-4-2" class="header-anchor">#</a> 步驟 4</h4> <p>在終端機打這些字：</p> <p><code>git commit -m &quot;Added all the things&quot;</code></p> <p><img src="/notepad/assets/img/Xnip2020-08-07_23-10-09.ec3d6049.jpg" alt=""></p> <p>git commit 告訴 git 真的要執行你叫它做的事。</p> <p>分成 add 和 commit 兩個步驟的好處是，如此你就可以把多個修改合併在一起。</p> <p>-m &quot;Added all the things 這個捷徑讓你可以直接寫下 commit message。</p> <h2 id="_3-3-在本機執行你的程式"><a href="#_3-3-在本機執行你的程式" class="header-anchor">#</a> 3-3 在本機執行你的程式</h2> <h3 id="目標-3"><a href="#目標-3" class="header-anchor">#</a> 目標</h3> <p>我們來把程式在本機啟動吧！</p> <h3 id="步驟-10"><a href="#步驟-10" class="header-anchor">#</a> 步驟</h3> <h4 id="步驟-1-3"><a href="#步驟-1-3" class="header-anchor">#</a> 步驟 1</h4> <p>在終端機打這些字：</p> <div class="language- extra-class"><pre class="language-text"><code>rails server
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>rails server</code> 可以簡寫為 <code>rails s</code></p></div> <h4 id="步驟-2-3"><a href="#步驟-2-3" class="header-anchor">#</a> 步驟 2</h4> <p>在你的瀏覽器打開 <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">http://localhost:3000<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>然後你就會看到的程式跑起來了！</p> <p><img src="/notepad/assets/img/Xnip2020-08-07_23-12-36.fd18c8a3.jpg" alt=""></p> <h4 id="步驟-3-3"><a href="#步驟-3-3" class="header-anchor">#</a> 步驟 3</h4> <p>在終端機裡面，server 跑起來的時候，隨時按下 <code>Ctrl+C</code> 就可以把 server 關掉。你可以馬上試試看。</p> <p><img src="/notepad/assets/img/Xnip2020-08-07_23-13-43.663c0729.jpg" alt=""></p> <h2 id="_3-4-建立-migration"><a href="#_3-4-建立-migration" class="header-anchor">#</a> 3-4 建立 Migration</h2> <h3 id="目標-4"><a href="#目標-4" class="header-anchor">#</a> 目標</h3> <p><img src="/notepad/assets/img/Xnip2020-08-07_23-22-14.d880dff9.jpg" alt=""></p> <p>我們的 suggestotron 會有一個 Topics （主題）列表讓大家來投票。我們會把 Topics 存進 database 裡面。在這一步你會做這些事：</p> <ul><li>在資料庫裡建立一個簡單的“表格（Table）”來儲存 Topics，每一篇 Topic 裡會有標題和正文內容。</li> <li>在 Rails 裡自動產生相對應的 Scaffold（包含 Model、View、Controller）。</li></ul> <h3 id="步驟-11"><a href="#步驟-11" class="header-anchor">#</a> 步驟</h3> <h4 id="步驟-1-4"><a href="#步驟-1-4" class="header-anchor">#</a> 步驟 1</h4> <p>在終端機打這些字：</p> <div class="language- extra-class"><pre class="language-text"><code>rails generate scaffold topic title:string description:text
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>rails generate</code> 可以簡寫為 <code>rails g</code></p></div> <ul><li><code>generate scaffold</code> 告訴 Rails 去建立一堆檔案讓 topics 可以動。</li> <li><code>topic</code> 是告訴 rails 新的 Model 的名字是什麼。</li> <li><code>title:string</code> 是說 topics 有標題（title），它是一個字串（String）。</li> <li><code>description:text</code> 是說 topics 有正文內容（description），它是一段文字（Text）。（“字串”跟“文字”的差別？基本上“文字”是用來儲存可能會很長的字串。）</li></ul> <p><img src="/notepad/assets/img/Xnip2020-08-07_23-23-33.1caf7c32.jpg" alt=""></p> <p>你若有興趣，可以花一點時間研究一下自動產生出來的檔案。</p> <p>補充教材：<a href="/notepad/fullstack-camp/02-04.html#_4-1-補充教材：rails-架構">“Rails 架構”</a></p> <h4 id="步驟-2-4"><a href="#步驟-2-4" class="header-anchor">#</a> 步驟 2</h4> <p>在終端機打這些字：</p> <p><code>rake db:migrate</code></p> <p><img src="/notepad/assets/img/Xnip2020-08-07_23-25-48.aa10dd8f.jpg" alt=""></p> <p>告訴 Rails 更新資料庫來建立一個用來儲存新的 Model 的表格（Table）。</p> <h2 id="_3-5-crud-和-scaffolding"><a href="#_3-5-crud-和-scaffolding" class="header-anchor">#</a> 3-5 CRUD 和 Scaffolding</h2> <h3 id="目標-5"><a href="#目標-5" class="header-anchor">#</a> 目標</h3> <p>大部份基於資料庫的網站，其核心都是一樣的，都要把資料存起來並且提供方法來做這些事：</p> <p><strong>C</strong> - 建立（<strong>C</strong>reate）新資料並存進資料庫。<br> <strong>R</strong> - 讀取（<strong>R</strong>ead）或顯示資料庫裡的資料。<br> <strong>U</strong> - 更新（<strong>U</strong>pdate）既有的資料。<br> <strong>D</strong> - 刪除（<strong>D</strong>estroy）資料。</p> <p>這四個操作（CRUD）常見到 Rails 把它內建到 scaffold 指令裡面，我們可以很容易實作出來。</p> <h3 id="步驟-12"><a href="#步驟-12" class="header-anchor">#</a> 步驟</h3> <h4 id="步驟-1-5"><a href="#步驟-1-5" class="header-anchor">#</a> 步驟 1</h4> <p>在瀏覽器打開 <a href="http://localhost:3000/topics" target="_blank" rel="noopener noreferrer">http://localhost:3000/topics<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>你應該會看到一個 “Listing Topics” 的頁面，有個空白但有 Title 和 Description 欄位標題的表格，還有一個連結可以新增 Topic：</p> <p><img src="/notepad/assets/img/Xnip2020-08-07_23-47-42.63b45e19.jpg" alt=""></p> <h4 id="步驟-2-5"><a href="#步驟-2-5" class="header-anchor">#</a> 步驟 2</h4> <ul><li>按一下 New Topic</li> <li>填寫表單，然後按一下 Create Topic</li> <li>你應該會看到一個網頁，裡面顯示你新建立的 topic，並且說你已經成功建立你的 topic 了：</li></ul> <p><img src="/notepad/assets/img/Xnip2020-08-07_23-49-04.3f658c23.jpg" alt=""></p> <h4 id="步驟-3-4"><a href="#步驟-3-4" class="header-anchor">#</a> 步驟 3</h4> <ul><li>按一下 back</li> <li>你應該會再看到 topics 列表，這次還有你剛剛新增的 topic：</li></ul> <p><img src="/notepad/assets/img/Xnip2020-08-07_23-49-36.648418fe.jpg" alt=""></p> <ul><li>試試看 show、edit、destroy 連結看看會發生什麼事。</li> <li>賀！你已經建立了一個基本的資料庫網站了！</li></ul> <h2 id="_3-6-設定首頁"><a href="#_3-6-設定首頁" class="header-anchor">#</a> 3-6 設定首頁</h2> <h3 id="目標-6"><a href="#目標-6" class="header-anchor">#</a> 目標</h3> <p>現在結構已經打好了，來把流程變順暢吧。</p> <p>現在你打開 <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">http://localhost:3000<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的話，你會看到 &quot;Yay! You’re on Rails!&quot; 的字樣。</p> <p>但如果 <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">http://localhost:3000<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 就可以直接跑到 topics 列表的話，會比較方便。</p> <p>所以在這一步我們會實現它，並從中學習 Rails 路由（routes）的基本。</p> <h3 id="步驟-13"><a href="#步驟-13" class="header-anchor">#</a> 步驟</h3> <h4 id="步驟-1：加入-root-route"><a href="#步驟-1：加入-root-route" class="header-anchor">#</a> 步驟 1：加入 root route</h4> <p>在 vscode 編輯器打開 config/routes.rb, 在</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>routes<span class="token punctuation">.</span>draw <span class="token keyword">do</span>
</code></pre></div><p>下面加一行</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>root <span class="token string">&quot;topics#index&quot;</span>
</code></pre></div><p>看起來會像這樣</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>routes<span class="token punctuation">.</span>draw <span class="token keyword">do</span>
  root <span class="token string">&quot;topics#index&quot;</span>
<span class="token keyword">end</span>
</code></pre></div><p><img src="/notepad/assets/img/Xnip2020-08-07_23-52-25.ce00ce62.jpg" alt=""></p> <p>請記得存檔 <code>⌘ command + s</code>，修改才會生效。</p> <h4 id="步驟-2：確認修改成功"><a href="#步驟-2：確認修改成功" class="header-anchor">#</a> 步驟 2：確認修改成功</h4> <p>回到 <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">http://localhost:3000<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 。你應該會被帶到 topics 列表。</p> <p><img src="/notepad/assets/img/Xnip2020-08-08_00-05-39.29252b59.jpg" alt=""></p> <h3 id="部署（deploying）"><a href="#部署（deploying）" class="header-anchor">#</a> 部署（Deploying）</h3> <p>在繼續下一步之前，你可以考慮把程式上傳到 Heroku！</p> <p>具體可以參考第一課<a href="/fullstack-camp/01-07#_7-2-%E4%B8%8A%E5%82%B3%E5%B0%88%E6%A1%88%E5%88%B0-heroku">相關章節</a></p> <h2 id="_3-7-對-topic-投票"><a href="#_3-7-對-topic-投票" class="header-anchor">#</a> 3-7 對 Topic 投票</h2> <h3 id="目標-7"><a href="#目標-7" class="header-anchor">#</a> 目標</h3> <ul><li>建立投票的 model</li></ul> <p><img src="/notepad/assets/img/Xnip2020-08-08_00-06-46.3205c562.jpg" alt=""></p> <p>Suggestotron 裡面的每一個 topic 都可以投票。為了計算票數，我們要有投票記錄。來加個 table 吧。</p> <h3 id="步驟-14"><a href="#步驟-14" class="header-anchor">#</a> 步驟</h3> <p>在終端機打這些字：</p> <div class="language- extra-class"><pre class="language-text"><code>rails generate model vote topic_id:integer
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>rake db:migrate
</code></pre></div><p><img src="/notepad/assets/img/Xnip2020-08-08_00-08-54.4884cff0.jpg" alt=""></p> <h2 id="_3-8-把投票記錄和-topics-接起來"><a href="#_3-8-把投票記錄和-topics-接起來" class="header-anchor">#</a> 3-8 把投票記錄和 Topics 接起來</h2> <h3 id="目標-8"><a href="#目標-8" class="header-anchor">#</a> 目標</h3> <p><img src="/notepad/assets/img/Xnip2020-08-08_00-09-42.a0d82899.jpg" alt=""></p> <p>資料庫裡面有了關聯號碼，接下來我們要來告訴 Rails，topic 和投票記錄之間有明確的關係。</p> <h3 id="步驟-15"><a href="#步驟-15" class="header-anchor">#</a> 步驟</h3> <h4 id="步驟-1：告訴-topic-model-有-vote（投票記錄）的存在"><a href="#步驟-1：告訴-topic-model-有-vote（投票記錄）的存在" class="header-anchor">#</a> 步驟 1：告訴 Topic model 有 Vote（投票記錄）的存在</h4> <p>編輯 app/models/topic.rb 讓它長得像這樣：</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Topic</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationRecord</span>
  has_many <span class="token symbol">:votes</span><span class="token punctuation">,</span> dependent<span class="token punctuation">:</span> <span class="token symbol">:destroy</span>
<span class="token keyword">end</span>
</code></pre></div><p><img src="/notepad/assets/img/Xnip2020-08-08_00-10-53.d0616791.jpg" alt=""></p> <h4 id="步驟-2：告訴-vote-model-有-topic-的存在"><a href="#步驟-2：告訴-vote-model-有-topic-的存在" class="header-anchor">#</a> 步驟 2：告訴 Vote model 有 Topic 的存在</h4> <p>編輯 app/models/vote.rb 讓它長得像這樣：</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Vote</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationRecord</span>
  belongs_to <span class="token symbol">:topic</span>
<span class="token keyword">end</span>
</code></pre></div><p><img src="/notepad/assets/img/Xnip2020-08-08_00-26-05.b9ff0726.jpg" alt=""></p> <h4 id="步驟-3：進-rails-console-隨便玩玩看-topic-和-vote-model"><a href="#步驟-3：進-rails-console-隨便玩玩看-topic-和-vote-model" class="header-anchor">#</a> 步驟 3：進 Rails console 隨便玩玩看 Topic 和 Vote model</h4> <p>首先，先確定你已經開了至少一篇 topic。</p> <p>然後，從終端機視窗進入 Rails console：</p> <p><code>rails c</code></p> <p>預期的結果：</p> <div class="language- extra-class"><pre class="language-text"><code>Running via Spring preloader in process 11071
Loading development environment (Rails 6.0.3.2)
2.7.1 :001 &gt;
</code></pre></div><p>在 console 裡面試試看這些指令：</p> <p>檢查總共有多少 topics：</p> <p>繼續在終端機輸入</p> <div class="language- extra-class"><pre class="language-text"><code>Topic.count
</code></pre></div><p>把第一篇 topic 存入變數</p> <div class="language- extra-class"><pre class="language-text"><code>my_topic = Topic.first
</code></pre></div><p>my_topic 可以是任何的變數名稱，不過現在我們一律用 my_topic。</p> <p>把那個 topic 的 title 改成別的：</p> <div class="language- extra-class"><pre class="language-text"><code>my_topic.update_attributes(title: 'Edited in the console')
</code></pre></div><p>新增一筆投票記錄給那個 topic：</p> <div class="language- extra-class"><pre class="language-text"><code>my_topic.votes.create
</code></pre></div><p>檢查 topic 總共有多少筆投票：</p> <div class="language- extra-class"><pre class="language-text"><code>my_topic.votes.count
</code></pre></div><p>刪除一筆那個 topic 的投票記錄：</p> <div class="language- extra-class"><pre class="language-text"><code>my_topic.votes.first.destroy
</code></pre></div><p>最後，記得輸入 <code>exit</code> 退出console。</p> <p>請注意，你在 <strong>Model class</strong>（例如 <strong>Topic</strong>、<strong>Vote</strong>）和 <strong>Model instance</strong>（例如此例的my_topic）可以做的事是不一樣的。my_topic.votes稱作 association，在這裡的行為比較像是 model class。</p> <div class="custom-block tip"><p class="custom-block-title">Class methods 和 Instance methods 的差異</p> <table><thead><tr><th>Model class / association 的 methods</th> <th>Model instance 的 methods</th></tr></thead> <tbody><tr><td>Topic.first</td> <td>my_topic.title</td></tr> <tr><td>Topic.last</td> <td>my_topic.title = 'New title'</td></tr> <tr><td>Topic.all</td> <td>my_topic.update_attributes(title: 'New title')</td></tr> <tr><td>Topic.count</td> <td>my_topic.save</td></tr> <tr><td>Topic.find_by_id(5)</td> <td>my_topic.save!</td></tr> <tr><td>Topic.destroy_all</td> <td>my_topic.destroy</td></tr> <tr><td>Topic.votes.count</td> <td>my_topic.votes.first.destroy</td></tr> <tr><td>Topic.votes.create</td> <td></td></tr> <tr><td>Topic.votes.destroy_all</td> <td></td></tr></tbody></table></div> <p>要看完整的列表的話，你可以上 <a href="http://guides.rubyonrails.org/active_record_querying.html" target="_blank" rel="noopener noreferrer">Active Record Query Interface RailsGuide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_3-9-讓大家可以投票"><a href="#_3-9-讓大家可以投票" class="header-anchor">#</a> 3-9 讓大家可以投票</h2> <h3 id="目標-9"><a href="#目標-9" class="header-anchor">#</a> 目標</h3> <p>現在我們要來加一個按鈕，讓大家可以按下去就投票加分。</p> <h3 id="步驟-16"><a href="#步驟-16" class="header-anchor">#</a> 步驟</h3> <h4 id="步驟-1：加一個新的-controller-action-來投票加分"><a href="#步驟-1：加一個新的-controller-action-來投票加分" class="header-anchor">#</a> 步驟 1：加一個新的 controller action 來投票加分</h4> <p>編輯 app/controllers/topics_controller.rb 然後把以下這個 method 加在 controller 下方的 private這個keyword 之上：</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">def</span> <span class="token method-definition"><span class="token function">upvote</span></span>
  <span class="token variable">@topic</span> <span class="token operator">=</span> <span class="token constant">Topic</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token variable">@topic</span><span class="token punctuation">.</span>votes<span class="token punctuation">.</span>create
  redirect_to<span class="token punctuation">(</span>topics_path<span class="token punctuation">)</span>
<span class="token keyword">end</span>
</code></pre></div><p><img src="/notepad/assets/img/Xnip2020-08-08_00-41-23.02b469fb.jpg" alt=""></p> <p><strong>我們來看一下以上程式碼的代表的意義</strong></p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token variable">@topic</span> <span class="token operator">=</span> <span class="token constant">Topic</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>從資料庫裡面用 id 找到 topic 然後存進 @topic 變數里面。</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token variable">@topic</span><span class="token punctuation">.</span>votes<span class="token punctuation">.</span>create
</code></pre></div><p>給目前這篇 topic 新增一筆投票記錄，然後存進資料庫裡面。</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>redirect_to<span class="token punctuation">(</span>topics_path<span class="token punctuation">)</span>
</code></pre></div><p>跟瀏覽器說要回到 topics_path（topics 的列表）。</p> <h4 id="步驟-2：給投票加分操作加一個-route"><a href="#步驟-2：給投票加分操作加一個-route" class="header-anchor">#</a> 步驟 2：給投票加分操作加一個 route</h4> <p>打開 config/routes.rb 然後找這個：</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>（略）
resources <span class="token symbol">:topics</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>（略）
</code></pre></div><p>取代之，讓整個檔案長得像這樣：</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>routes<span class="token punctuation">.</span>draw <span class="token keyword">do</span>
  root <span class="token string">'topics#index'</span>
  resources <span class="token symbol">:topics</span> <span class="token keyword">do</span>
    member <span class="token keyword">do</span>
      post <span class="token string">'upvote'</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p><img src="/notepad/assets/img/Xnip2020-08-08_00-43-31.8461fb4a.jpg" alt=""></p> <p>現在來檢查 route 有成功加入，方法是看一下 <code>rake routes</code> 的輸出結果，或是打開 <a href="http://localhost:3000/rails/info" target="_blank" rel="noopener noreferrer">http://localhost:3000/rails/info<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。你應該會看到有一行長得像這樣：</p> <p><img src="/notepad/assets/img/Xnip2020-08-08_00-47-03.95326df4.jpg" alt=""></p> <h4 id="步驟-3：在-view-裡面加一個按鈕"><a href="#步驟-3：在-view-裡面加一個按鈕" class="header-anchor">#</a> 步驟 3：在 view 裡面加一個按鈕</h4> <p>編輯 <code>app/views/topics/index.html.erb</code> 讓最下面的 loop（迴圈）程式碼長得像這樣：</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token variable">@topics</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span><span class="token operator">|</span>topic<span class="token operator">|</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> topic<span class="token punctuation">.</span>title <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> topic<span class="token punctuation">.</span>description <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> pluralize<span class="token punctuation">(</span>topic<span class="token punctuation">.</span>votes<span class="token punctuation">.</span>count<span class="token punctuation">,</span> <span class="token string">&quot;vote&quot;</span><span class="token punctuation">)</span> <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> button_to <span class="token string">'+1'</span><span class="token punctuation">,</span> upvote_topic_path<span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">,</span> method<span class="token punctuation">:</span> <span class="token symbol">:post</span> <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> link_to <span class="token string">'Show'</span><span class="token punctuation">,</span> topic <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> link_to <span class="token string">'Edit'</span><span class="token punctuation">,</span> edit_topic_path<span class="token punctuation">(</span>topic<span class="token punctuation">)</span> <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> link_to <span class="token string">'Destroy'</span><span class="token punctuation">,</span> topic<span class="token punctuation">,</span> method<span class="token punctuation">:</span> <span class="token symbol">:delete</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span> confirm<span class="token punctuation">:</span> <span class="token string">'Are you sure?'</span> <span class="token punctuation">}</span> <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">end</span> <span class="token delimiter punctuation">%&gt;</span></span>
</code></pre></div><p><img src="/notepad/assets/img/Xnip2020-08-08_00-49-44.17b18880.jpg" alt=""></p> <p><strong>我們來看一下以上程式碼的代表的意義</strong></p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>pluralize<span class="token punctuation">(</span>topic<span class="token punctuation">.</span>votes<span class="token punctuation">.</span>count<span class="token punctuation">,</span> <span class="token string">&quot;vote&quot;</span><span class="token punctuation">)</span> 
</code></pre></div><p>會輸出票數，並且根據（英文的）單複數在後面加上 'vote' 或 'votes' 單字。</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>button_to <span class="token string">'+1'</span>
</code></pre></div><p>加一個 HTML 的按鈕（button），裡面有字 '+1'。</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>upvote_topic_path<span class="token punctuation">(</span>topic<span class="token punctuation">)</span>
</code></pre></div><p>產生我們要呼叫的 action 的對應 URL。以此例而言，我們要對目前的 topic 投票加分。它會回傳 <code>/topics/42/upvote</code>（假設 topic.id 是 42 的話）</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>method<span class="token punctuation">:</span> <span class="token symbol">:post</span>
</code></pre></div><p>確保我們使用了 CRUD 裡面的 create 操作，而非 read。</p> <h4 id="步驟-4：在瀏覽器裡面檢查修改成功"><a href="#步驟-4：在瀏覽器裡面檢查修改成功" class="header-anchor">#</a> 步驟 4：在瀏覽器裡面檢查修改成功</h4> <p>回到 <a href="http://localhost:3000/topics" target="_blank" rel="noopener noreferrer">http://localhost:3000/topics<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 然後隨便玩玩看。</p> <p>嗯，你發現了嗎，Rails程式可以一邊執行一邊被修改，不用“關閉--修改--重開”，酷吧？</p> <p><img src="/notepad/assets/img/Xnip2020-08-08_08-32-16.535db96d.jpg" alt=""></p> <h3 id="部署（deploying）-2"><a href="#部署（deploying）-2" class="header-anchor">#</a> 部署（Deploying）</h3> <p>在繼續下一步之前，你可以考慮把程式上傳到 Heroku！</p> <h2 id="_3-10-新增後能夠回到-topics-列表"><a href="#_3-10-新增後能夠回到-topics-列表" class="header-anchor">#</a> 3-10 新增後能夠回到 topics 列表</h2> <p>當使用者建立了一篇新的 topic、或是編輯既有的 topic 的時候，使用者將會看到單獨那一篇 topic 的頁面。但對於我們的投票程式來說，如果能夠回到 topics 列表會更好。</p> <p>所以在這一步裡面我們將會修改程式的流程，讓 user 新增（create）topic 或編輯（update）topic 之後可以回到 topics 列表。</p> <h3 id="步驟-17"><a href="#步驟-17" class="header-anchor">#</a> 步驟</h3> <h4 id="步驟-1：修改-topics-controller"><a href="#步驟-1：修改-topics-controller" class="header-anchor">#</a> 步驟 1：修改 topics controller</h4> <p>打開 app/controllers/topics_controller.rb 找到 create method。</p> <p>找這一行：</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>format<span class="token punctuation">.</span>html <span class="token punctuation">{</span> redirect_to <span class="token variable">@topic</span><span class="token punctuation">,</span> notice<span class="token punctuation">:</span> <span class="token string">'Topic was successfully created.'</span> <span class="token punctuation">}</span>
</code></pre></div><p>把 @topic 改成 topics_path，像這樣：</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>format<span class="token punctuation">.</span>html <span class="token punctuation">{</span> redirect_to topics_path<span class="token punctuation">,</span> notice<span class="token punctuation">:</span> <span class="token string">'Topic was successfully created.'</span> <span class="token punctuation">}</span>
</code></pre></div><p>最後會長得像這樣：</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/controllers/topics_controller.rb</span>
<span class="token keyword">def</span> <span class="token method-definition"><span class="token function">create</span></span>
  <span class="token variable">@topic</span> <span class="token operator">=</span><span class="token constant">Topic</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>topic_params<span class="token punctuation">)</span>

  respond_to <span class="token keyword">do</span> <span class="token operator">|</span>format<span class="token operator">|</span>
    <span class="token keyword">if</span> <span class="token variable">@topic</span><span class="token punctuation">.</span>save
      format<span class="token punctuation">.</span>html <span class="token punctuation">{</span> redirect_to topics_path<span class="token punctuation">,</span> notice<span class="token punctuation">:</span> <span class="token string">'Topic was successfully created.'</span> <span class="token punctuation">}</span>
      format<span class="token punctuation">.</span>json <span class="token punctuation">{</span> render <span class="token symbol">:show</span><span class="token punctuation">,</span> status<span class="token punctuation">:</span> <span class="token symbol">:created</span><span class="token punctuation">,</span> location<span class="token punctuation">:</span> <span class="token variable">@topic</span> <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
      format<span class="token punctuation">.</span>html <span class="token punctuation">{</span> render <span class="token symbol">:new</span> <span class="token punctuation">}</span>
      format<span class="token punctuation">.</span>json <span class="token punctuation">{</span> render json<span class="token punctuation">:</span> <span class="token variable">@topic</span><span class="token punctuation">.</span>errors<span class="token punctuation">,</span> status<span class="token punctuation">:</span> <span class="token symbol">:unprocessable_entity</span> <span class="token punctuation">}</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p><img src="/notepad/assets/img/Xnip2020-08-08_09-45-22.ca6f4677.jpg" alt=""></p> <p>然後在同一個檔案裡面，找到 update method。</p> <p>找這一行：</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>format<span class="token punctuation">.</span>html <span class="token punctuation">{</span> redirect_to <span class="token variable">@topic</span><span class="token punctuation">,</span> notice<span class="token punctuation">:</span> <span class="token string">'Topic was successfully updated.'</span> <span class="token punctuation">}</span>
</code></pre></div><p>跟之前一樣，把 @topic 改成 topics_path：</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>format<span class="token punctuation">.</span>html <span class="token punctuation">{</span> redirect_to topics_path<span class="token punctuation">,</span> notice<span class="token punctuation">:</span> <span class="token string">'Topic was successfully updated.'</span> <span class="token punctuation">}</span>
</code></pre></div><p><img src="/notepad/assets/img/Xnip2020-08-08_09-46-43.2fd2a3cc.jpg" alt=""></p> <h4 id="步驟-2：確認修改成功-2"><a href="#步驟-2：確認修改成功-2" class="header-anchor">#</a> 步驟 2：確認修改成功</h4> <p>打開 <a href="http://localhost:3000/topics" target="_blank" rel="noopener noreferrer">http://localhost:3000/topics<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 然後玩玩看。</p> <h2 id="_3-11-把-topic-標題變成可以點選的超連結"><a href="#_3-11-把-topic-標題變成可以點選的超連結" class="header-anchor">#</a> 3-11 把 Topic 標題變成可以點選的超連結</h2> <h3 id="目標-10"><a href="#目標-10" class="header-anchor">#</a> 目標</h3> <p>你朋友建議你把網站修改以下 2 個地方，看起來會更好：</p> <ul><li>不要在 topics 列表頁面出現本文內容。</li> <li>把 topics 變成超連結，使用者必須點選 topics 才會顯示本文內容。</li></ul> <h3 id="步驟-18"><a href="#步驟-18" class="header-anchor">#</a> 步驟</h3> <h4 id="步驟-1：拿掉本文內容"><a href="#步驟-1：拿掉本文內容" class="header-anchor">#</a> 步驟 1：拿掉本文內容</h4> <p>首先來拿掉本文內容（description）吧。打開 app/views/topics/index.html.erb 然後刪掉這一行：</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> topic<span class="token punctuation">.</span>description <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>也刪掉這一行</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Description<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="/notepad/assets/img/Xnip2020-08-08_21-15-56.db648cc0.jpg" alt=""></p> <p>現在可以試試看在瀏覽器裡面重新刷新，你應該會發現正文內容消失了。</p> <h4 id="步驟-2：把標題變成超連結"><a href="#步驟-2：把標題變成超連結" class="header-anchor">#</a> 步驟 2：把標題變成超連結</h4> <p>現在來把標題變成超鏈接，編輯 app/views/topics/index.html.erb 然後把這一行：</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> topic<span class="token punctuation">.</span>title <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>改成這樣：</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> link_to topic<span class="token punctuation">.</span>title<span class="token punctuation">,</span> topic <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="/notepad/assets/img/Xnip2020-08-08_21-18-07.dadec000.jpg" alt=""></p> <h2 id="_3-12-清理-topics-列表"><a href="#_3-12-清理-topics-列表" class="header-anchor">#</a> 3-12 清理 Topics 列表</h2> <h3 id="目標-11"><a href="#目標-11" class="header-anchor">#</a> 目標</h3> <p>我們的程式快要完成了！topics 列表頁看起來很冗長。其實有一些連結是沒有用的。<br>
來清理一下吧：</p> <ul><li>刪掉 show 超連結。</li> <li>刪掉 edit 超連結。</li> <li>把 destroy 改成 delete。</li></ul> <h3 id="步驟-19"><a href="#步驟-19" class="header-anchor">#</a> 步驟</h3> <h4 id="步驟-1：刪掉-show-和-edit-超連結"><a href="#步驟-1：刪掉-show-和-edit-超連結" class="header-anchor">#</a> 步驟 1：刪掉 show 和 edit 超連結</h4> <p>打開 app/views/topics/index.html.erb 刪除這兩行：</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> link_to <span class="token string">'Show'</span><span class="token punctuation">,</span> topic <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> link_to <span class="token string">'Edit'</span><span class="token punctuation">,</span> edit_topic_path<span class="token punctuation">(</span>topic<span class="token punctuation">)</span> <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="步驟-2：把-destroy-改成-delete"><a href="#步驟-2：把-destroy-改成-delete" class="header-anchor">#</a> 步驟 2：把 destroy 改成 delete</h4> <p>把有 Destroy 字樣的那一行修改成這樣：</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span>link_to <span class="token string">'Delete'</span><span class="token punctuation">,</span> topic<span class="token punctuation">,</span> method<span class="token punctuation">:</span> <span class="token symbol">:delete</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span> confirm<span class="token punctuation">:</span> <span class="token string">'Are you sure?'</span> <span class="token punctuation">}</span> <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="/notepad/assets/img/Xnip2020-08-09_09-45-27.cabef60b.jpg" alt=""></p> <h4 id="步驟-3：確認修改成功"><a href="#步驟-3：確認修改成功" class="header-anchor">#</a> 步驟 3：確認修改成功</h4> <p>存檔，然後重新刷新瀏覽器，看看修改有沒有成功。</p> <h2 id="_3-13-加分題-下一步"><a href="#_3-13-加分題-下一步" class="header-anchor">#</a> 3-13 加分題 &amp; 下一步</h2> <blockquote><p>請做完第三課中級練習的同學再回來做</p></blockquote> <h3 id="加分題"><a href="#加分題" class="header-anchor">#</a> 加分題</h3> <p>如果你完成了 Suggestotron 而還剩下一些時間，你可以試試看這些：</p> <ul><li>加一個“扣分”按鈕，做的事跟加分按鈕相反。</li> <li>根據投票分數排序 topics。</li> <li>新增一個 'about' 頁面，並將連結放在 topics 列表的最下方。記得也要在 About 頁面上放置回 Topics 列表的連結，以免使用者迷路。</li></ul> <h2 id="_3-14-賀！你剛-完成-了你的第一個-rails-程式！"><a href="#_3-14-賀！你剛-完成-了你的第一個-rails-程式！" class="header-anchor">#</a> 3-14 賀！你剛“完成”了你的第一個 Rails 程式！</h2> <p>你知道嗎？你<strong>做完了</strong>！！！<br>
賀！你剛“完成”了你的第一個 Rails 程式！</p> <p>接下來你可以進到： <strong>Rails101</strong></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最後更新時間:</span> <span class="time">2020-8-12 0:14:53</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notepad/fullstack-camp/02-02.html" class="prev">
        2-Ruby 程式語言
      </a></span> <span class="next"><a href="/notepad/fullstack-camp/02-04.html">
        4-補充教材
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notepad/assets/js/app.abc900cd.js" defer></script><script src="/notepad/assets/js/2.de767da7.js" defer></script><script src="/notepad/assets/js/3.b28a5640.js" defer></script>
  </body>
</html>
