(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{303:function(t,s,a){t.exports=a.p+"assets/img/maxresdefault.e54cdc22.jpg"},513:function(t,s,a){"use strict";a.r(s);var n=a(23),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"_5-加入使用者功能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-加入使用者功能"}},[t._v("#")]),t._v(" 5-加入使用者功能")]),t._v(" "),n("blockquote",[n("p",[t._v("預計學習時間: 2小時以內")])]),t._v(" "),n("h2",{attrs:{id:"_5-1-本章目標"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-本章目標"}},[t._v("#")]),t._v(" 5-1 本章目標")]),t._v(" "),n("h3",{attrs:{id:"本章目標"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#本章目標"}},[t._v("#")]),t._v(" 本章目標")]),t._v(" "),n("ul",[n("li",[t._v("安裝“會員系統”（使用 devise）")]),t._v(" "),n("li",[t._v("在 navbar 安裝登錄/退出按鈕")]),t._v(" "),n("li",[t._v("只有登錄了的使用者，才可以建立群組")]),t._v(" "),n("li",[t._v("只有群組的建立者，才可以 編輯 / 刪除群組")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("h2",{attrs:{id:"_5-2-安裝-devise-gem"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-安裝-devise-gem"}},[t._v("#")]),t._v(" 5-2 安裝 devise gem")]),t._v(" "),n("h3",{attrs:{id:"目標"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#目標"}},[t._v("#")]),t._v(" 目標")]),t._v(" "),n("ul",[n("li",[t._v("做會員系統似乎很困難？讓我告訴你，在 Rails 內一點都不會！")]),t._v(" "),n("li",[t._v("利用 devise 實作會員系統")])]),t._v(" "),n("h3",{attrs:{id:"步驟"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步驟"}},[t._v("#")]),t._v(" 步驟")]),t._v(" "),n("h4",{attrs:{id:"step-0-git-checkout-b-ch04"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-0-git-checkout-b-ch04"}},[t._v("#")]),t._v(" Step 0. git checkout -b ch04")]),t._v(" "),n("p",[t._v("因為我們現在要實作第四章的內容，新增一個 branch 把實作內容集中在 ch04 是比較合理的。將來回顧就可以比較清楚 在 ch04 我們做了哪一些練習。")]),t._v(" "),n("p",[n("code",[t._v("git checkout -b ch04")])]),t._v(" "),n("h4",{attrs:{id:"step-1-安裝登錄系統"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-1-安裝登錄系統"}},[t._v("#")]),t._v(" Step 1: 安裝登錄系統")]),t._v(" "),n("p",[t._v("Devise 是一個 Rails 內熱門的 gem，專門用來快速實作“登錄系統”。在這一章我們會用 devise 實作登錄功能。")]),t._v(" "),n("p",[t._v("Gemfile 新增一行 gem 'devise'")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[t._v("gem "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'devise'")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("p",[t._v("然後執行")]),t._v(" "),n("p",[n("code",[t._v("bundle install")])]),t._v(" "),n("h4",{attrs:{id:"step-2-產生會員系統的必要文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-2-產生會員系統的必要文件"}},[t._v("#")]),t._v(" Step 2 : 產生會員系統的必要文件")]),t._v(" "),n("p",[t._v("執行")]),t._v(" "),n("p",[n("code",[t._v("rails g devise:install")]),n("br"),t._v(" "),n("code",[t._v("rails g devise user")]),n("br"),t._v(" "),n("code",[t._v("rake db:migrate")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("p",[t._v("然後重開 rails server")]),t._v(" "),n("h4",{attrs:{id:"step-3-在-groups-controller-限制-新增討論群-必須先登錄"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-3-在-groups-controller-限制-新增討論群-必須先登錄"}},[t._v("#")]),t._v(" Step 3: 在 groups_controller 限制 “新增討論群”必須先登錄")]),t._v(" "),n("p",[t._v("在 app/controllers/groups_controller.rb 加入一行 before_action :authenticate_user! , only: [:new]")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/controllers/groups_controller.rb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GroupsController")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ApplicationController")]),t._v("\n  before_action "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":authenticate_user!")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" only"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":new")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#...略")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("p",[t._v("然後這時候當你要訪問 http://localhost:3000/groups/new 時，就會出現“登錄畫面”阻擋。可以註冊一個賬戶試試效果。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"step-4-git-存檔"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-4-git-存檔"}},[t._v("#")]),t._v(" Step 4: git 存檔")]),t._v(" "),n("p",[n("code",[t._v("git add .")]),n("br"),t._v(" "),n("code",[t._v('git commit -m "install devise"')])]),t._v(" "),n("h3",{attrs:{id:"本節常見問題"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#本節常見問題"}},[t._v("#")]),t._v(" 本節常見問題")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("devise 幫我們做了什麼？")]),t._v(" "),n("p",[t._v("在這一階段的細節，你不太需要知道他是怎麼運作？（事實上也很複雜）")]),t._v(" "),n("ul",[n("li",[t._v("你只要知道 "),n("code",[t._v("before_action :authenticate_user!")]),t._v(" 可以幫你做出“限制使用者必須登入”的功能。")])])]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("before_action 又是什麼呢？")]),t._v(" "),n("p",[t._v("before_action 後面加的往往是一個 controller 內的 method，在這裡 :authenticate_user! 是 devise 提供的內建功能。")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("before_action :authenticate_user! , only: [:new]")]),t._v("，表示“只有 new 需要登入”")]),t._v(" "),n("li",[n("code",[t._v("before_action :authenticate_user!")]),t._v(" 後面不加任何東西，表示這個 controller 下的所有 action 都要登入。")]),t._v(" "),n("li",[t._v("你可以把 before_action 想像成“先過我這一關”的“攔截器”")])])]),t._v(" "),n("h2",{attrs:{id:"_5-3-讓這個網站有實際-登錄-、-退出-的功能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-讓這個網站有實際-登錄-、-退出-的功能"}},[t._v("#")]),t._v(" 5-3 讓這個網站有實際“登錄”、“退出”的功能")]),t._v(" "),n("h3",{attrs:{id:"目標-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#目標-2"}},[t._v("#")]),t._v(" 目標")]),t._v(" "),n("ul",[n("li",[t._v("讓右上角的“登錄”可以實際有：“登錄” / “退出的效果”")])]),t._v(" "),n("h3",{attrs:{id:"步驟-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步驟-2"}},[t._v("#")]),t._v(" 步驟")]),t._v(" "),n("h4",{attrs:{id:"step-1-修改-app-views-common-navbar-html-erb"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-1-修改-app-views-common-navbar-html-erb"}},[t._v("#")]),t._v(" Step 1: 修改 app/views/common/_navbar.html.erb")]),t._v(" "),n("div",{staticClass:"language-erb extra-class"},[n("pre",{pre:!0,attrs:{class:"language-erb"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- app/views/common/_navbar.html.erb --\x3e")]),t._v("\n- "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n-   "),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%=")]),t._v(" link_to"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"登錄"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v("\n- "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n+ "),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("current_user "),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v("\n+   "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%=")]),t._v(" link_to"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"註冊"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" new_user_registration_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n+   "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%=")]),t._v(" link_to"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"登錄"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" new_user_session_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n+ "),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v("\n+   "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dropdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n+     "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("#"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dropdown-toggle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("data-toggle")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dropdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n+         Hi!, "),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%=")]),t._v(" current_user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("email "),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v("\n+         "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("b")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("caret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("b")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n+     "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n+     "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ul")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dropdown-menu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n+         "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%=")]),t._v(" link_to"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"退出"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" destroy_user_session_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n+     "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("ul")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n+   "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n+ "),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v("\n")])])]),n("p",[n("strong",[t._v("（+號代表新增的意思，複製貼上的時候請刪掉它，-號代表刪除的意思）")])]),t._v(" "),n("h4",{attrs:{id:"step-2-修改-app-assets-javascripts-application-js"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-2-修改-app-assets-javascripts-application-js"}},[t._v("#")]),t._v(" Step 2: 修改 app/assets/javascripts/application.js")]),t._v(" "),n("p",[t._v("加入 //= require bootstrap/dropdown")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//= require bootstrap/alert")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//= require bootstrap/dropdown")]),t._v("\n")])])]),n("p",[n("strong",[t._v("（+號代表新增的意思，複製貼上的時候請刪掉它）")])]),t._v(" "),n("p",[t._v("成果應該會是這樣的效果。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"step-3-git-儲存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-3-git-儲存"}},[t._v("#")]),t._v(" Step 3: git 儲存")]),t._v(" "),n("p",[n("code",[t._v("git add .")]),n("br"),t._v(" "),n("code",[t._v('git commit -m "user can login/logout/signup"')])]),t._v(" "),n("h3",{attrs:{id:"本節常見問題-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#本節常見問題-2"}},[t._v("#")]),t._v(" 本節常見問題")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("current_user 是什麼？")]),t._v(" "),n("p",[t._v("current_user 是 Devise 提供的“正在登入的當前用戶”，你可以在 controller 或 view 裡面使用它。")])]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("!current_user 又是什麼")]),t._v(" "),n("p",[t._v("! 表示不等於。!current_user 表示“現在沒有登入的用戶”（不在登入的狀態）")])]),t._v(" "),n("h2",{attrs:{id:"_5-4-讓-群組-與-使用者-產生關聯"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-讓-群組-與-使用者-產生關聯"}},[t._v("#")]),t._v(" 5-4 讓“群組”與“使用者”產生關聯")]),t._v(" "),n("h3",{attrs:{id:"目標-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#目標-3"}},[t._v("#")]),t._v(" 目標")]),t._v(" "),n("ul",[n("li",[t._v("我們要讓“群組”記錄是“被誰開的”。")]),t._v(" "),n("li",[t._v("並且在看板一覽表顯示出來“開設者的名稱”")])]),t._v(" "),n("h3",{attrs:{id:"步驟-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步驟-3"}},[t._v("#")]),t._v(" 步驟")]),t._v(" "),n("h4",{attrs:{id:"step-1-新增-user-id-到-group-的-table-裡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-1-新增-user-id-到-group-的-table-裡"}},[t._v("#")]),t._v(" Step 1: 新增 user_id 到 group 的 table 裡")]),t._v(" "),n("p",[t._v("執行")]),t._v(" "),n("p",[n("code",[t._v("rails g migration add_user_id_to_group")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("p",[t._v("然後打開剛剛新增的 migration 檔，修改讓它長得像這樣")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# db/migrate/一串數字_add_user_id_to_group")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AddUserIdToGroup")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ActiveRecord")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Migration")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token method-definition"}},[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("change")])]),t._v("\n    add_column "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":groups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":user_id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":integer")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("p",[t._v("然後，執行")]),t._v(" "),n("p",[n("code",[t._v("rake db:migrate")])]),t._v(" "),n("h4",{attrs:{id:"step-2-連結-user-與-group-的雙向關係"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-2-連結-user-與-group-的雙向關係"}},[t._v("#")]),t._v(" Step 2: 連結 user 與 group 的雙向關係")]),t._v(" "),n("p",[t._v("修改 app/models/user.rb 加入 has_many :groups")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/models/user.rb")]),t._v("\nclassUser "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ApplicationRecord")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Include default devise modules. Others available are:")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# :confirmable, :lockable, :timeoutable and :omniauthable")]),t._v("\n  devise "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":database_authenticatable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":registerable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":recoverable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":rememberable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":trackable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":validatable")]),t._v("\n\n  has_many "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":groups")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("p",[t._v("修改 app/models/group.rb 加入 belongs_to :user")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/models/group.rb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Group")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ApplicationRecord")]),t._v("\n  belongs_to "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":user")]),t._v("\n  validates "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" presence"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("h3",{attrs:{id:"step-3-在新增看板時，記錄誰是群組的建立者"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-3-在新增看板時，記錄誰是群組的建立者"}},[t._v("#")]),t._v(" Step 3: 在新增看板時，記錄誰是群組的建立者")]),t._v(" "),n("p",[t._v("修改 app/controllers/groups_controller.rb，在需要“登入驗證”的 action 列表再加入 create。")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/controllers/groups_controller.rb")]),t._v("\nclassGroupsController "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ApplicationController")]),t._v("\n  before_action "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":authenticate_user!")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" only"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":new")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":create")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#...略")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("p",[t._v("修改 app/controllers/groups_controller.rb，在 create 中，多加入一行 @group.user = current_user。")]),t._v(" "),n("p",[t._v("變成以下內容：")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/controllers/groups_controller.rb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token method-definition"}},[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")])]),t._v(" \n  "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("group_params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" current_user\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("save\n    redirect_to groups_path\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n    render "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":new")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("h4",{attrs:{id:"step-4-git-儲存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-4-git-儲存"}},[t._v("#")]),t._v(" Step 4 : git 儲存")]),t._v(" "),n("p",[n("code",[t._v("git add .")]),n("br"),t._v(" "),n("code",[t._v('git commit -m "add user_id to group"')])]),t._v(" "),n("h4",{attrs:{id:"step-5-修改-group-列表，將-user-的名字列上去"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-5-修改-group-列表，將-user-的名字列上去"}},[t._v("#")]),t._v(" Step 5 : 修改 group 列表，將 user 的名字列上去")]),t._v(" "),n("p",[t._v("修改 app/views/groups/index.html.erb 然後把 Creator 的訊息加進去。（程式碼如下）")]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("div",{staticClass:"language-erb extra-class"},[n("pre",{pre:!0,attrs:{class:"language-erb"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- app/views/groups/index.html.erb --\x3e")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("col-md-12"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("group"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%=")]),t._v(" link_to"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"New group"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" new_group_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"btn btn-primary pull-right"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("table")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("table table-hover"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("thead")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("tr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("#"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Title"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Description"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n+       "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Creator "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("tr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("thead")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("tbody")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@groups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("each")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("group"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("tr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("#"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%=")]),t._v(" link_to"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("group"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" group_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("group"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%=")]),t._v(" group"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("description "),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n+         "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%=")]),t._v(" group"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("email "),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%=")]),t._v(" link_to"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Edit"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" edit_group_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("group"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"btn btn-sm btn-default"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%=")]),t._v(" link_to"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Delete"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" group_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("group"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"btn btn-sm btn-default"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                          method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" confirm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Are you sure?"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("tr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token erb language-erb"}},[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("tbody")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("table")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[t._v("做完之後，打開 http://localhost:3000/ 會發現，首頁怎麼爆炸了。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("p",[t._v("別擔心，這是因為我們之前創造的“群組”都是“無主”的。只要把這些“無主”的群組，通通刪掉就行了。既然我們也進不去首頁刪群組了，我們就從 console 刪吧。")]),t._v(" "),n("h4",{attrs:{id:"step-6-刪除所有-無主-的群組"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-6-刪除所有-無主-的群組"}},[t._v("#")]),t._v(" Step 6: 刪除所有“無主”的群組")]),t._v(" "),n("p",[t._v("執行")]),t._v(" "),n("p",[n("code",[t._v("rails console")])]),t._v(" "),n("p",[t._v("然後輸入")]),t._v(" "),n("p",[n("code",[t._v("Group.delete_all")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("p",[t._v("輸入 "),n("code",[t._v("exit")]),t._v(" 退出 console")]),t._v(" "),n("p",[t._v("然後再打開 http://localhost:3000/ 就正常了。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("p",[t._v("這時候我們再新增一筆數據，就會顯示 creator 的訊息了。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"step-7-git-存檔"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-7-git-存檔"}},[t._v("#")]),t._v(" Step 7 : git 存檔")]),t._v(" "),n("p",[n("code",[t._v("git add .")]),n("br"),t._v(" "),n("code",[t._v('git commit -m "show group\'s creator info "')])]),t._v(" "),n("h3",{attrs:{id:"本節常見問題-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#本節常見問題-3"}},[t._v("#")]),t._v(" 本節常見問題")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("has_many 與 belongs_to 是什麼意思？")]),t._v(" "),n("p",[t._v("has_many 擁有很多\nbelongs_to 屬於\n就是這麼直觀！記得你一定要幫他們加上關聯！")])]),t._v(" "),n("h2",{attrs:{id:"_5-5-只有群組的-創始者-可以-編輯-刪除-群組資訊"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-只有群組的-創始者-可以-編輯-刪除-群組資訊"}},[t._v("#")]),t._v(" 5-5 只有群組的“創始者”可以“編輯”“刪除”群組資訊")]),t._v(" "),n("h3",{attrs:{id:"目標-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#目標-4"}},[t._v("#")]),t._v(" 目標")]),t._v(" "),n("ul",[n("li",[t._v("路人不應該可以看到“編輯”“刪除”按鈕")]),t._v(" "),n("li",[t._v("只有群組的“創始者”可以實際執行“編輯”“刪除”群組資訊")])]),t._v(" "),n("h3",{attrs:{id:"步驟-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步驟-4"}},[t._v("#")]),t._v(" 步驟")]),t._v(" "),n("h4",{attrs:{id:"step-1-路人不應該可以看到-編輯-刪除-按鈕"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-1-路人不應該可以看到-編輯-刪除-按鈕"}},[t._v("#")]),t._v(" Step 1: 路人不應該可以看到“編輯”“刪除”按鈕")]),t._v(" "),n("p",[t._v("讓我們登出系統，在這裡我們察覺一個嚴重的問題：明明是路人，怎麼能看到“編輯”“刪除”按鈕的資訊呢？")]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("p",[t._v("所以在這裡我們要把“編輯”“刪除”這兩個按鈕藏起來，限定")]),t._v(" "),n("ul",[n("li",[t._v("只有登入模式下")]),t._v(" "),n("li",[t._v("而且還必須是群組“創始者”")])]),t._v(" "),n("p",[t._v("才能看得到這個兩個按鈕，否則路人是看不到的。")]),t._v(" "),n("p",[t._v("修改 app/views/groups/index.html.erb")]),t._v(" "),n("p",[t._v("加入   <% if current_user && current_user == group.user %> 的判斷式")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/views/groups/index.html.erb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("td"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" current_user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" current_user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" group"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('%>\n  <%= link_to("Edit", edit_group_path(group), class: "btn btn-sm btn-default")%>')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" link_to"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Delete"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" group_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("group"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"btn btn-sm btn-default"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" confirm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Are you sure?"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("%>\n+ <% end %>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("td"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("p",[t._v("重新刷新首頁，路人現在就看不到按鈕了。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"step-2-git-存檔"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-2-git-存檔"}},[t._v("#")]),t._v(" Step 2: git 存檔")]),t._v(" "),n("p",[n("code",[t._v("git add .")]),n("br"),t._v(" "),n("code",[t._v('git commit -m "people can\'t see edit button unless he is group owner"')])]),t._v(" "),n("h4",{attrs:{id:"step-3-路人不應該也可以-直接輸入網址-去存取-edit-update-destroy-action"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-3-路人不應該也可以-直接輸入網址-去存取-edit-update-destroy-action"}},[t._v("#")]),t._v(" Step 3: 路人不應該也可以“直接輸入網址”去存取 edit / update / destroy action")]),t._v(" "),n("p",[t._v("除了將按鈕對路人隱藏外，我們還要考慮到一個情形，假設這個路人是知道 Rails 規則的，那麼他可能輸入")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("http://localhost:3000/groups/某筆數據的ID/edit\n")])])]),n("p",[t._v("網址，就直接可以編輯數據。")]),t._v(" "),n("p",[t._v("我們也要在 controller 做權限判斷，濾掉這種人。")]),t._v(" "),n("p",[t._v("首先，我們先限定 edit / update / destroy 這三個操作動作，必須要是“登入”的使用者才能存取。")]),t._v(" "),n("p",[t._v("修改 app/controllers/groups_controller.rb 在 before_action :authenticate_user!  列表中，加入 :edit, :update, :destroy")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/controllers/groups_controller.rb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GroupsController")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ApplicationController")]),t._v("\n  before_action "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":authenticate_user!")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" only"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":new")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":create")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":edit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":destroy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#...略")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("p",[t._v("這樣“沒登錄”的路人，就進不來了。但這只是第一步。")]),t._v(" "),n("h4",{attrs:{id:"step-4-必須要是-group-擁有人，才能進入-edit，否則會被重導至首頁，並顯示錯誤訊息。"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-4-必須要是-group-擁有人，才能進入-edit，否則會被重導至首頁，並顯示錯誤訊息。"}},[t._v("#")]),t._v(" Step 4: 必須要是 group 擁有人，才能進入 edit，否則會被重導至首頁，並顯示錯誤訊息。")]),t._v(" "),n("p",[t._v("修改 app/controllers/groups_controller.rb 加入權限，如果不是“創始者”去存取，會顯示沒有權限的錯誤訊息。")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/controllers/groups_controller.rb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token method-definition"}},[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("edit")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" current_user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user\n    redirect_to root_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" alert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"You have no permission."')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("p",[t._v("這樣當其他人，試圖輸入")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("http://localhost:3000/groups/某筆數據的ID/edit\n")])])]),n("p",[t._v("這樣的網址，想要編輯數據，就會被擋住。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"step-5-依樣畫葫蘆的把-權限檢查-的程式碼，套用到-update-destroy-上"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-5-依樣畫葫蘆的把-權限檢查-的程式碼，套用到-update-destroy-上"}},[t._v("#")]),t._v(" Step 5: 依樣畫葫蘆的把“權限檢查”的程式碼，套用到 update / destroy 上")]),t._v(" "),n("p",[t._v("修改 app/controllers/groups_controller.rb 中的 update 與 destroy 部分。")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/controllers/groups_controller.rb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token method-definition"}},[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" current_user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user\n    redirect_to root_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" alert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"You have no permission."')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("group_params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    redirect_to groups_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" notice"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Update Success"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n    render "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":edit")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token method-definition"}},[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("destroy")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" current_user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user\n    redirect_to root_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" alert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"You have no permission."')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("destroy\n  redirect_to groups_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" alert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Group deleted"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("h4",{attrs:{id:"step-6-git-存檔"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-6-git-存檔"}},[t._v("#")]),t._v(" Step 6: git 存檔")]),t._v(" "),n("p",[n("code",[t._v("git add .")]),n("br"),t._v(" "),n("code",[t._v('git commit -m "check owner permission when access edit/update/destroy"')])]),t._v(" "),n("h4",{attrs:{id:"step-7-製作-find-group-and-check-permission"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-7-製作-find-group-and-check-permission"}},[t._v("#")]),t._v(" Step 7: 製作 find_group_and_check_permission")]),t._v(" "),n("p",[t._v("我們發現 edit、update、destroy 這三個 action 都有一樣的程式碼，看起來有點冗。")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" current_user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user\n  redirect_to root_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" alert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"You have no permission."')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("p",[t._v("其實我們可以透過把它包裝成一個函式的方式 find_group_and_check_permission 去省略這段冗餘程式碼。")]),t._v(" "),n("p",[t._v("打開 app/controllers/groups_controller.rb  在 private 下，新增一個 find_group_and_check_permission")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/controllers/groups_controller.rb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ...略")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token method-definition"}},[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("find_group_and_check_permission")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" current_user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user\n      redirect_to root_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" alert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"You have no permission."')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token method-definition"}},[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("group_params")])]),t._v("\n    params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("permit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":description")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("p",[t._v("再修正 edit")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/controllers/groups_controller.rb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token method-definition"}},[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("edit")])]),t._v("\n  find_group_and_check_permission\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("p",[t._v("修正 update")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/controllers/groups_controller.rb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token method-definition"}},[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")])]),t._v("\n  find_group_and_check_permission\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("group_params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    redirect_to groups_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" notice"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Update Success"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n    render "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":edit")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("p",[t._v("修正 destroy")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/controllers/groups_controller.rb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token method-definition"}},[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("destroy")])]),t._v("\n  find_group_and_check_permission\n\n  "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("destroy\n  redirect_to groups_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" alert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Group deleted"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("h4",{attrs:{id:"step-8-把-find-group-and-check-permission-掛到-before-action"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-8-把-find-group-and-check-permission-掛到-before-action"}},[t._v("#")]),t._v(" Step 8: 把 find_group_and_check_permission 掛到 before_action")]),t._v(" "),n("p",[t._v("開發到這裡你會發現一件事，find_group_and_check_permission 其實都是在這三個 action 的最前面開頭執行的，所以你甚至可以這樣寫，把 find_group_and_check_permission 掛到 before_action")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/controllers/groups_controller.rb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GroupsController")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ApplicationController")]),t._v("\n  before_action "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":authenticate_user!")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" only"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":new")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":create")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":edit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":destroy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  before_action "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":find_group_and_check_permission")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" only"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":edit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":destroy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ...略")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("p",[t._v("然後再把 edit update destroy 裡的 find_group_and_check_permission 砍掉。變成這樣：")]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/controllers/groups_controller.rb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token method-definition"}},[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("edit")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token method-definition"}},[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("group_params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    redirect_to groups_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" notice"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Update Success"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n    render "),n("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":edit")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token method-definition"}},[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("destroy")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("destroy\n  redirect_to groups_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" alert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Group deleted"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),n("h4",{attrs:{id:"step-9-git-存檔"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-9-git-存檔"}},[t._v("#")]),t._v(" Step 9: git 存檔")]),t._v(" "),n("p",[n("code",[t._v("git add .")]),n("br"),t._v(" "),n("code",[t._v('git commit -m "use before_action to find_group_and_check_permission"')])]),t._v(" "),n("h4",{attrs:{id:"step-10-修掉-show-裡面的-edit-按鈕"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-10-修掉-show-裡面的-edit-按鈕"}},[t._v("#")]),t._v(" Step 10 : 修掉 show 裡面的 Edit 按鈕")]),t._v(" "),n("p",[t._v("做到這裡，我們還發現一個地方，我們漏了改，那就是 show.html.erb 上面，還有一個 Edit 按鈕我們還沒有拔掉。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("p",[t._v("修改 app/views/groups/show.html.erb ，然後加入")]),t._v(" "),n("p",[t._v("加入 <% if current_user && current_user == @group.user %> 的判斷式")]),t._v(" "),n("p",[n("img",{attrs:{src:a(303),alt:""}})]),t._v(" "),n("div",{staticClass:"language-ruby extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app/views/groups/show.html.erb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"group"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" current_user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" current_user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('%>\n    <%= link_to("Edit", edit_group_path(@group), class: "btn btn-primary pull-right")%>')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("%>\n</div>")]),t._v("\n")])])]),n("p",[t._v("如此按鈕就被修掉了。")]),t._v(" "),n("h4",{attrs:{id:"step-11-git-存檔"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#step-11-git-存檔"}},[t._v("#")]),t._v(" Step 11: git 存檔")]),t._v(" "),n("p",[n("code",[t._v("git add .")]),n("br"),t._v(" "),n("code",[t._v('git commit -m "add permission check on show page"')])]),t._v(" "),n("h3",{attrs:{id:"本節常見問題-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#本節常見問題-4"}},[t._v("#")]),t._v(" 本節常見問題")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("= 與 == 與 != 他們三者是什麼？")]),t._v(" "),n("ul",[n("li",[t._v("= 是指派。@groups = Group.all，把 Group.all 數值 指派給 @groups 的意思。")]),t._v(" "),n("li",[t._v("== “等於”")]),t._v(" "),n("li",[t._v("!= “不等於”")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);